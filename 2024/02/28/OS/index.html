<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="Hexo Theme Redefine">
    <meta name="description" content="Jackcui personal homepage.">
    <meta name="author" content="Jackcui">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-redefine.png">
    <!-- preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://evan.beee.top" crossorigin>
    
    <!--- Seo Part-->
    
    <link rel="canonical" href="http://example.com/2024/02/28/os/"/>
    <meta name="robots" content="index,follow">
    <meta name="googlebot" content="index,follow">
    <meta name="revisit-after" content="1 days">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Talk to the Godâ€”â€”Notes for jyy OS">
    <meta property="og:description" content="Jackcui personal homepage.">
    <meta property="og:url" content="http://example.com2024/02/28/OS/">
    
    <meta property="og:site_name" content="Jackcui&#39;s Chatter">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Talk to the Godâ€”â€”Notes for jyy OS">
    <meta name="twitter:description" content="Jackcui personal homepage.">
    <meta name="twitter:image" content="/images/redefine-logo.svg">
    <!--- Icon Part-->
    <link rel="icon" type="image/png" href="/images/redefine-logo.svg" sizes="192x192">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/redefine-logo.svg">
    <meta name="theme-color" content="#005080">
    <link rel="shortcut icon" href="/images/redefine-logo.svg">
    <!--- Page Info-->
    
    <title>
        
            Talk to the Godâ€”â€”Notes for jyy OS -
        
        Jackcui&#39;s Chatter
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    
<link rel="stylesheet" href="/assets/fonts.css">

    <!--- Font Part-->
    
    
    
    

    <!--- Inject Part-->
    
    <script id="hexo-configurations">
    let REDEFINE = window.REDEFINE || {};
    REDEFINE.hexo_config = {"hostname":"example.com","root":"/","language":"en","path":"search.xml"};
    REDEFINE.theme_config = {"toc":{"enable":true,"number":false,"expand_all":true,"init_open":true},"style":{"primary_color":"#005080","avatar":"https://s2.loli.net/2023/03/24/nBqwGYDJx6CdZr7.png","favicon":"/images/redefine-logo.svg","og_image":{"enable":false,"image_url":null},"article_img_align":"center","right_side_width":"210px","content_max_width":"1000px","nav_color":{"left":"#f78736","right":"#367df7","transparency":35},"hover":{"shadow":true,"scale":false},"first_screen":{"enable":true,"background_image":{"light":"/images/wallhaven-wqery6-light.webp","dark":"/images/wallhaven-wqery6-dark.webp"},"title_color":{"light":"#fff","dark":"#d1d1b6"},"font_sizes":{"title":"2.8rem","subtitle":"1.5rem"},"line_height":1.2,"title":"131a6ea Not Found","subtitle":{"enable":true,"list":["We go near, we go far.","We got found, we got lost"]},"custom_font":{"enable":false,"font_family":null,"font_url":null}},"scroll":{"progress_bar":{"enable":true},"percent":{"enable":false}}},"local_search":{"enable":true,"preload":true},"code_block":{"copy":true,"style":"mac","custom_font":{"enable":false,"font_family":null,"font_url":null}},"pjax":{"enable":true},"lazyload":{"enable":true},"version":"1.2.3","friend_links":{"columns":2},"home_article":{"date_format":"auto","category":{"enable":true,"limit":3},"tag":{"enable":true,"limit":3}},"plugins":{"aplayer":{"enable":true,"audio":[{"name":"ç¾å¥½äº‹ç‰©","artist":"æˆ¿ä¸œçš„çŒ«","url":"/mhsw.mp3","cover":"/mhsw.jpg"},{"name":null,"artist":null,"url":null,"cover":null}]},"mermaid":{"enable":false,"version":"9.3.0"}}};
    REDEFINE.language_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
  </script>
    
    <!--- Fontawesome Part-->
    
<link rel="stylesheet" href="/fontawesome/fontawesome.min.css">

    
<link rel="stylesheet" href="/fontawesome/brands.min.css">

    
<link rel="stylesheet" href="/fontawesome/solid.min.css">

    
<link rel="stylesheet" href="/fontawesome/regular.min.css">

    
    
    
    
<meta name="generator" content="Hexo 6.3.0"><style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style></head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
        <span class="pjax-progress-bar"></span>
        <span class="pjax-progress-icon">
            <i class="fa-solid fa-circle-notch fa-spin"></i>
        </span>
    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="menu-wrapper">
    
    <div class="menu-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                
                Jackcui&#39;s Chatter
                
            </a>
        </div>

        <div class="right">
            <!-- PC -->
            <div class="pc">
                <ul class="menu-list">
                    
                        
                            <li class="menu-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/"  >
                                    
                                        
                                            <i class="fa-regular fa-house"></i>
                                        
                                        HOME
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="menu-item">
                                <!-- Menu -->
                                <a class="has-dropdown" 
                                    href="#" onClick="return false;">
                                    
                                        
                                            <i class="fa-solid fa-dove"></i>
                                        
                                        LINKS&nbsp;<i class="fa-solid fa-chevron-down"></i>
                                    
                                </a>
                                <!-- Submenu -->
                                
                                    <ul class="sub-menu">
                                    
                                        <li>
                                        <a href="/links">FRIEND LINK
                                        </a>
                                        </li>
                                    
                                    </ul>
                                
                            </li>
                    
                        
                            <li class="menu-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/UNacceptable"  >
                                    
                                        
                                            <i class="fa-solid fa-alien-8bit"></i>
                                        
                                        UNW
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="menu-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/tags"  >
                                    
                                        
                                            <i class="fa-duotone fa-hashtag"></i>
                                        
                                        TAG
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fa-solid fa-magnifying-glass"></i>
                        </li>
                    
                </ul>
            </div>
            <!-- Mobile -->
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fa-solid fa-magnifying-glass"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile drawer -->
    <div class="menu-drawer">
        <ul class="drawer-menu-list">
            
                
                    <li class="drawer-menu-item flex-center">
                        <a class="" 
                        href="/"  >
                             
                                
                                    <i class="fa-regular fa-house"></i>
                                
                                HOME
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-menu-item flex-center">
                        <a class="has-dropdown" 
                        href="#" onClick="return false;">
                            
                                
                                    <i class="fa-solid fa-dove"></i>
                                
                                LINKS&nbsp;<i class="fa-solid fa-chevron-down"></i>
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                              
                        
                            <li class="dropdown-item flex-center">
                                <a class="dropdown-item" href="/links">FRIEND LINK</a>
                            </li>
                        
                    
            
                
                    <li class="drawer-menu-item flex-center">
                        <a class="" 
                        href="/UNacceptable"  >
                             
                                
                                    <i class="fa-solid fa-alien-8bit"></i>
                                
                                UNW
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-menu-item flex-center">
                        <a class="" 
                        href="/tags"  >
                             
                                
                                    <i class="fa-duotone fa-hashtag"></i>
                                
                                TAG
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            

        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="post-page-container">
        <div class="article-content-container">

            
            
                <div class="article-title">
                    <h1 class="article-title-regular">Talk to the Godâ€”â€”Notes for jyy OS</h1>
                </div>
            
                
            

            
                <div class="article-header">
                    <div class="avatar">
                        <img src="https://s2.loli.net/2023/03/24/nBqwGYDJx6CdZr7.png">
                    </div>
                    <div class="info">
                        <div class="author">
                            <span class="name">Jackcui</span>
                            
                                <span class="author-label">NJU Loser</span>
                            
                        </div>
                        <div class="meta-info">
                            <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fa-regular fa-pen-fancy"></i>&nbsp;
        <span class="pc">2024-02-28 09:02:59</span>
        <span class="mobile">2024-02-28 09:02</span>
        <span class="hover-info">Created</span>
    </span>
    
        <span class="article-date article-meta-item">
            <i class="fa-regular fa-wrench"></i>&nbsp;
            <span class="pc">2024-06-06 11:01:15</span>
            <span class="mobile">2024-06-06 11:01</span>
            <span class="hover-info">Updated</span>
        </span>
    

    
    
        <span class="article-tags article-meta-item">
            <i class="fa-regular fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/CS/">CS</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/tags/Notes/">Notes</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fa-regular fa-file-word"></i>&nbsp;<span>9.4k Words</span>
        </span>
    
    
        <span class="article-min2read article-meta-item">
            <i class="fa-regular fa-clock"></i>&nbsp;<span>34 Mins</span>
        </span>
    
    
        <span class="article-pv article-meta-item">
            <i class="fa-regular fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                        </div>
                    </div>
                </div>
            

            <div class="article-content markdown-body">
                <h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><p>jyy â€˜The Green Advisorâ€™ OS, NJU 2024 Spring<br>License same as the original course.</p>
<h2 id="Waiting-List"><a href="#Waiting-List" class="headerlink" title="Waiting List"></a>Waiting List</h2><ul>
<li>ç¬¬ä¸€èŠ‚ â›”</li>
<li>ç¬¬äºŒèŠ‚ â›”</li>
<li>M1 âœ… ğŸ›ğŸ›ğŸ›</li>
<li>ç¬¬ä¸‰èŠ‚ â›”</li>
<li>ç¬¬å››èŠ‚ â›”</li>
<li>L0 â›”</li>
<li>ç¬¬äº”èŠ‚ â›”</li>
<li>ç¬¬å…­èŠ‚ â›”</li>
<li>ç¬¬ä¸ƒèŠ‚ âœ…<ul>
<li>é˜…è¯»XV6æºç </li>
<li>ç¾¤é™¤æˆ‘ä½¬çš„é—®é¢˜</li>
<li>*benchmark crimesçš„é˜…è¯»</li>
<li>*RCUç»†èŠ‚ï¼ˆç¼ºå°‘é“¾æ¥ï¼‰</li>
</ul>
</li>
<li>ç¬¬å…«èŠ‚ âœ…<ul>
<li>å­¦ä¹ ä¸€ä¸‹GDB in Python</li>
<li>é˜…è¯»GDBæ–‡æ¡£ï¼Œquick guide, cheat sheet</li>
</ul>
</li>
<li>ç¬¬ä¹èŠ‚ âœ… ğŸ›</li>
<li>ç¬¬åèŠ‚ â›”</li>
<li>ç¬¬åä¸€èŠ‚ âœ…</li>
<li>ç¬¬åäºŒèŠ‚ âœ…</li>
<li>ç¬¬åä¸‰èŠ‚ â›”</li>
<li>ç¬¬åå››èŠ‚ âœ… ğŸ›</li>
<li>ç¬¬åäº”èŠ‚ â›”</li>
<li>ç¬¬åå…­èŠ‚ â›”</li>
<li>ç¬¬åä¸ƒèŠ‚ âœ… ğŸ›ğŸ›ğŸ›ğŸ›ğŸ›ğŸ›ğŸ›</li>
<li>ç¬¬åå…«èŠ‚ â›”</li>
<li>ç¬¬åä¹èŠ‚ â›”</li>
<li>ç¬¬äºŒåèŠ‚ â›”</li>
<li>ç¬¬äºŒåä¸€èŠ‚ â›”</li>
<li>ç¬¬äºŒåäºŒèŠ‚ âœ… ğŸ›XV6é‡è¦ï¼</li>
<li>ç¬¬äºŒåä¸‰èŠ‚ â›”</li>
<li>ç¬¬äºŒåå››èŠ‚ â›”</li>
<li>ç¬¬äºŒåäº”èŠ‚ â›”</li>
</ul>
<h2 id="ç»ªè®º"><a href="#ç»ªè®º" class="headerlink" title="ç»ªè®º"></a>ç»ªè®º</h2><p>åœ¨åšäº†å……è¶³çš„å¿ƒç†å‡†å¤‡ä¹‹åï¼Œç»ˆäºå†³å®šæŠ¥äº†jyyè€å¸ˆçš„OSã€‚</p>
<blockquote>
<p>ä¸–ç•Œä¸Šæœ‰ä¸¤ç§äººï¼šæ²¡è§è¿‡<strong>ç¥</strong>çš„äººå’Œè§è¿‡jyyçš„äººã€‚</p>
</blockquote>
<p><strong>ç¥</strong>è‡ªæˆ‘é©å‘½ï¼Œ<strong>ç¥</strong>åˆ¶é€ å›°å¢ƒï¼Œ<strong>ç¥</strong>ä¼ è¾¾å¯ç¤ºï¼Œ<strong>ç¥</strong>å¼•å‘çµæ„Ÿã€‚<br>æœ¬ç¯‡ä½œä¸ºä¸<strong>ç¥</strong>çš„å¯¹è¯ï¼Œå¿ å®è®°å½•äº† jyyOS 24Spring çš„è¯¾ç¨‹ç¬”è®°ï¼Œå®éªŒå®å½•ï¼Œæ•™æè¯»ä¹¦ç¬”è®°å’Œå¿ƒå¾—æ„Ÿå—ã€‚</p>
<h3 id="ç‰¹åˆ«è¯´æ˜"><a href="#ç‰¹åˆ«è¯´æ˜" class="headerlink" title="ç‰¹åˆ«è¯´æ˜"></a>ç‰¹åˆ«è¯´æ˜</h3><p>ä¸ºäº†æ›´é€‚åº”è‹±æ–‡ç¯å¢ƒï¼Œå…¶å®ç»å¤§å¤šæ•°çš„ç¬”è®°éƒ½ä½¿ç”¨è‹±è¯­æ¥è®°äº†ï¼Œä½†ç”±äºç»¿å¯¼å¸ˆçš„å†…å®¹æ¯”è¾ƒæ·±ï¼Œå¤§é¢ç§¯çš„ä½¿ç”¨è‹±è¯­ä¼šä½¿å¾—â€œå†æå–â€éå¸¸å›°éš¾(é¸¡å°¾é…’ä¼šæ•ˆåº”)ï¼Œè€Œä¸”ä¸ªåˆ«æ€è€ƒå†…å®¹æˆ‘ç¬¬ä¸€æ¬¡ç”¨è‹±è¯­ä¹±æ‰¾ä¸€ä¸ªè¯´æ³•å†™ä¸Šï¼Œä¸‹æ¬¡è‡ªå·±éƒ½çœ‹ä¸æ‡‚ä»€ä¹ˆæ„æ€ï¼Œå› æ­¤å°±ç”¨ä¸­æ–‡è®°äº†ï¼Œæˆ‘å¯am noté‚£ç§Chineseè‹±è¯­mixç€è¯´çš„â€™fashion speakerâ€™(doge)</p>
<h2 id="Lecture-1"><a href="#Lecture-1" class="headerlink" title="Lecture 1"></a>Lecture 1</h2><div class="note-large notel-blue"><div class="notel-title"><p>OSTEP Chapter 1,2</p>
</div><div class="notel-content"><p>3 Easy Pieces: virtualization, concurrency, persistence</p>
<ul>
<li><p>virtualization: physicalâ€”virtualizationâ€“&gt;virtual form<br><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="10.854ex" height="1.602ex" role="img" focusable="false" viewBox="0 -697 4797.6 708"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mtext"><path data-c="1D40E" d="M64 339Q64 431 96 502T182 614T295 675T420 696Q469 696 481 695Q620 680 709 589T798 339Q798 173 697 82T432 -10Q262 -10 163 85T64 339ZM625 454Q618 502 600 538T562 593T515 624T469 639T431 642Q331 642 276 563Q232 493 232 353Q232 315 234 285T244 216T267 148T308 94T372 56Q405 46 432 46Q517 46 567 106T627 267Q631 299 631 353Q631 418 625 454Z"></path><path data-c="1D412" d="M64 493Q64 582 120 636T264 696H272Q280 697 285 697Q380 697 454 645L480 669Q484 672 488 676T495 683T500 688T504 691T508 693T511 695T514 696T517 697T522 697Q536 697 539 691T542 652V577Q542 557 542 532T543 500Q543 472 540 465T524 458H511H505Q489 458 485 461T479 478Q472 529 449 564T393 614T336 634T287 639Q228 639 203 610T177 544Q177 517 195 493T247 457Q253 454 343 436T475 391Q574 326 574 207V200Q574 163 559 120Q517 12 389 -9Q380 -10 346 -10Q308 -10 275 -5T221 7T184 22T160 35T151 40L126 17Q122 14 118 10T111 3T106 -2T102 -5T98 -7T95 -9T92 -10T89 -11T84 -11Q70 -11 67 -4T64 35V108Q64 128 64 153T63 185Q63 203 63 211T69 223T77 227T94 228H100Q118 228 122 225T126 205Q130 125 193 88T345 51Q408 51 434 82T460 157Q460 196 439 221T388 257Q384 259 305 276T221 295Q155 313 110 366T64 493Z" transform="translate(864,0)"></path></g><g data-mml-node="mo" transform="translate(1780.8,0)"><path data-c="2248" d="M55 319Q55 360 72 393T114 444T163 472T205 482Q207 482 213 482T223 483Q262 483 296 468T393 413L443 381Q502 346 553 346Q609 346 649 375T694 454Q694 465 698 474T708 483Q722 483 722 452Q722 386 675 338T555 289Q514 289 468 310T388 357T308 404T224 426Q164 426 125 393T83 318Q81 289 69 289Q55 289 55 319ZM55 85Q55 126 72 159T114 210T163 238T205 248Q207 248 213 248T223 249Q262 249 296 234T393 179L443 147Q502 112 553 112Q609 112 649 141T694 220Q694 249 708 249T722 217Q722 153 675 104T555 55Q514 55 468 76T388 123T308 170T224 192Q164 192 125 159T83 84Q80 55 69 55Q55 55 55 85Z"></path></g><g data-mml-node="mtext" transform="translate(2836.6,0)"><path data-c="1D415" d="M592 686H604Q615 685 631 685T666 684T700 684T724 683Q829 683 835 686H843V624H744L611 315Q584 254 546 165Q492 40 482 19T461 -6L460 -7H409Q398 -4 391 9Q385 20 257 315L124 624H25V686H36Q57 683 190 683Q340 683 364 686H377V624H289L384 403L480 185L492 212Q504 240 529 298T575 405L670 624H582V686H592Z"></path><path data-c="1D40C" d="M314 0Q296 3 181 3T48 0H39V62H147V624H39V686H305Q316 679 323 667Q330 653 434 414L546 157L658 414Q766 662 773 674Q778 681 788 686H1052V624H944V62H1052V0H1040Q1016 3 874 3T708 0H696V62H804V341L803 618L786 580Q770 543 735 462T671 315Q540 13 536 9Q528 1 507 1Q485 1 477 9Q472 14 408 162T281 457T217 603Q215 603 215 334V62H323V0H314Z" transform="translate(869,0)"></path></g></g></g></svg></mjx-container><br>*<strong>standard library</strong> (APIs)<br>*<strong>resource manager</strong><br>ctrl-c used to terminate the <strong>foreground</strong> program in UNIX-based OSs<br><strong>ALSR</strong>: Address Space Layout Randomization: randomized the address where executables are put each time when the process is created to avoid buffer overflow attacks</p>
</li>
<li><p>concurrency: differenet processes â€˜simultaneousâ€™<br>*due to the OS execute the instruction groups not atomically, ill-designed multithreading programs may have unexpected results</p>
</li>
<li><p>persistence: store data persistently, namely, I/O<br><strong>journaling</strong>:keep track of changes made to data<br>JBD: Journaling Block Device<br>and WAL in database<br><strong>copy-on-write</strong>:delay the copying of data until the moment itâ€™s actually modified.<br>duplicate on use</p>
</li>
</ul>
<p>Design aims:</p>
<ul>
<li>abstractions</li>
<li>performance</li>
<li>protection(isolation)</li>
<li>reliability(not fail)</li>
<li>â€¦</li>
</ul>
<p>OS historyâ€¦</p>
 </div></div>


<h2 id="Lecture-2"><a href="#Lecture-2" class="headerlink" title="Lecture 2"></a>Lecture 2</h2><div class="note note-primary icon-padding"><i class="note-icon fa-solid fa-circle-arrow-right"></i><p><a class="link" target="_blank" rel="noopener" href="https://jyywiki.cn/OS/2024/lect2.md">åŠ¡å¿…æ­é…jyywikié£Ÿç”¨ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a><br>å¯ä»¥è®¤ä¸ºæ˜¯å¯¹çŠ¶æ€æœºæ¨¡å‹çš„æ·±å…¥é˜è¿°ï¼š<br>yzhç‰ˆæœ¬ï¼š<a class="link" target="_blank" rel="noopener" href="https://jackcuii.github.io/2023/07/04/ysyx0004/">https://jackcuii.github.io/2023/07/04/ysyx0004/ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
</div>

<p><em>â€œæœ€å°çš„åº”ç”¨ç¨‹åºâ€</em> è¯´æ˜äº†ä»€ä¹ˆï¼Ÿ ç¨‹åºæ˜¯çŠ¶æ€æœºï¼ŒçŠ¶æ€æœºä¸èƒ½é€€å‡ºè‡ªå·±ï¼Œåªèƒ½ä»å¤–éƒ¨é€€å‡ºï¼Œæ“ä½œç³»ç»Ÿä¹Ÿæ˜¯ç¨‹åºï¼Œä¹Ÿæ˜¯çŠ¶æ€æœºï¼Œä¹Ÿä¸èƒ½é€€å‡ºè‡ªå·±ã€‚<br>ç”¨æˆ·ç¨‹åºâ€”ç”¨syscallâ€”å€ŸåŠ©â€”&gt;æ“ä½œç³»ç»Ÿâ€”ç”¨I/O messageâ€”å€ŸåŠ©â€”&gt;ç¡¬ä»¶ æ¥é€€å‡ºè‡ªå·±ã€‚</p>
<blockquote>
<p>ç¡¬ä»¶å‘¢ï¼Ÿå®ƒä¹Ÿæ˜¯çŠ¶æ€æœºï¼Œä½†ä»ä¸»æ¿æ€»æ§çš„è§†è§’ä¸Šçœ‹ï¼Œä¾›ç”µæ§åˆ¶ç³»ç»Ÿæ˜¯ä¼ºæœè¿è¡Œçš„ï¼Œå®ƒ<strong>ä»æœª</strong> <code>é€€å‡º</code> è¿‡</p>
</blockquote>
<p>æ·±å…¥ç†è§£çŠ¶æ€æœºæ¨¡å‹ï¼šç†è§£è°ƒç”¨å’Œé€’å½’<br><em>case:Cè¯­è¨€è§£é‡Šå™¨è§£å†³å‡½æ•°è°ƒç”¨</em></p>
<p>2.1 å’Œ 2.2 è¿˜æ²¡</p>
<p>é€’å½’å‘éé€’å½’çš„è½¬æ¢ï¼š<br>å…¶å®å°±æ˜¯æ‰‹åŠ¨æ¥å®ç°äº†æ ˆï¼Œä¹Ÿå°±æ˜¯å‡½æ•°è°ƒç”¨çš„è¿‡ç¨‹ï¼Œè·³å‡ºâ€œå‡ºå»å›æ¥â€çš„æ€ç»´æ¨¡å¼ï¼Œä¸€åˆ‡å…¶å®éƒ½æ˜¯åœ¨â€œé¡ºåºâ€ â€œå‰è¿›â€</p>
<blockquote>
<p>æŸç§ç¨‹åº¦ä¸Šè¯´ï¼Œéƒ½æ˜¯é€’å½’ï¼Œæˆ–è€…è¯´éé€’å½’å°±æ˜¯é€’å½’ï¼Œé€’å½’å¯ä»¥è®¤ä¸ºæ˜¯ä¸€ç§å›ºæœ‰çš„å½¢å¼é€»è¾‘ï¼Ÿ</p>
</blockquote>
<div class="note-large notel-red"><div class="notel-title"><p>Spicy</p>
</div><div class="notel-content"><p>æ›´æ·±å…¥åœ°ç†è§£çŠ¶æ€æœºï¼šç†è§£ç¼–è¯‘å’Œä¼˜åŒ–<br>ç¼–è¯‘å°±æ˜¯çŠ¶æ€æœºä¹‹é—´æ˜ å°„ã€‚<br>ä»€ä¹ˆæ˜¯ä¼˜åŒ–ï¼Ÿå°±æ˜¯è¡Œä¸ºä¸å˜æé«˜æ•ˆç‡/å‡å°‘èµ„æºæ¶ˆè€—ã€‚ä»€ä¹ˆæ˜¯è¡Œä¸ºä¸å˜ï¼Ÿå°±æ˜¯<strong>ç³»ç»Ÿè°ƒç”¨ä¸å˜</strong>ã€‚ï¼ˆå…¶ä½™çš„æ“ä½œ<strong>éƒ½æ˜¯é»‘ç®±</strong>ï¼Œåªæœ‰è°ƒç”¨æ‰å’Œå¤–ç•Œäº§ç”Ÿè”ç³»ï¼‰<br>ä¸ä»…å¦‚æ­¤ï¼Ÿç³»ç»Ÿè°ƒç”¨ä¹Ÿå¯ä»¥æ”¹å˜ï¼Œä¿è¯ç³»ç»Ÿè°ƒç”¨çš„è¡Œä¸ºä¸€è‡´ï¼ˆ<strong>è¡Œä¸ºçš„è¡Œä¸º</strong>ï¼‰ï¼Œå¯ä»¥æŠŠç¨‹åºæœ¬èº«somehowåšæˆè°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†ã€‚ï¼ˆå‰æ²¿äº†ï¼‰<br>é¢â€¦é‚£è¿™å’Œæ²¡æœ‰æ“ä½œç³»ç»Ÿçš„åŒºåˆ«åœ¨äºï¼Ÿ</p>
 </div></div>

<p>è¿˜æœ‰å¾ˆå¤šğŸ›ğŸ›ğŸ›ğŸ›</p>
<hr>
<h2 id="M1-pstree"><a href="#M1-pstree" class="headerlink" title="M1:pstree"></a>M1:pstree</h2><div class="note-large notel-green"><div class="notel-title"><p>M1 Log</p>
</div><div class="notel-content"><ul>
<li>ç¡®å®è§‰å¾—ç¥–ä¼ ä»£ç åº”è¯¥å¥½å¥½æ‰“å‡»äº†!<ul>
<li>hyè€å¸ˆä¸Šå‘¨å®£å¸ƒç®—æ³•çš„OJç”±äº<strong>ç³»é‡Œç¦æ­¢</strong>æŸ¥é‡è€Œå–æ¶ˆï¼Œè¿™ä¸¤ä»¶äº‹å¯¹æ¯”èµ·æ¥çœ‹è®©äººå”å˜˜å•Šã€‚ã€‚ã€‚</li>
</ul>
</li>
<li>å­¦ä¹ jyyåœ¨å‘½ä»¤è¡Œé‡Œæ¥å…¥äº†GPTï¼Œæ„Ÿè§‰æ–¹ä¾¿äº†è®¸å¤šï¼</li>
<li>æ²¡çœ‹åé¢çš„å°±æƒ³ï¼ˆé—®GPTï¼‰åˆ°äº†åœ¨å“ªæ‰¾åˆ°stateï¼Œåˆ‡å®æ„Ÿè§‰åˆ°äº†æ–¹æ³•è®ºçš„å˜åŒ–ï¼ˆGPT on the shell ä¹‹åï¼Œé—®GPTä¸ç”¨ç‚¹é¼ æ ‡äº†ï¼Œé¢‘ç‡é£™å‡ï¼‰</li>
<li>ğŸ› <a class="link" target="_blank" rel="noopener" href="https://pubs.opengroup.org/onlinepubs/9699919799/basedefs/V1_chap12.html">æ¬ å€ºï¼šPOSIXå‚æ•°çº¦å®š <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li>
<li>ç¼–å†™å¯ç§»æ¤çš„ä»£ç ï¼Ÿï¼Ÿï¼Ÿ</li>
<li>å…³äºHard Testçš„äº‹ä¾‹ï¼Œç•¥æ„Ÿææƒ§<ul>
<li>è¿™ä¸ªè™½ç„¶ç»™å‡ºäº†,ä½†ä»¥åçš„å®éªŒå‘¢ï¼Œæƒ³éƒ½ä¸æ•¢æƒ³ã€‚ã€‚ã€‚</li>
<li>è¿™ä¸ªæˆ–è®¸å¯ä»¥é€šè¿‡straceæ¥å‘ç°ï¼Œä½†â€œè¡Œä¸ºç›¸åŒâ€åˆ°è¿™ä¸ªç¨‹åº¦â€¦â€¦</li>
<li>å¦å¤–å°±æ˜¯å‘ç°OJå¹³å°å¥½åƒå¯ä»¥çœ‹åˆ°é”™è¯¯è¿”å›å€¼</li>
</ul>
</li>
</ul>
<div class="note-large notel-red"><div class="notel-title"><p>SpicyğŸŒ¶ï¸</p>
</div><div class="notel-content"><ul>
<li>Windows Kernel -&gt; offer API</li>
<li>UNIX (Philosophy) -&gt; Everything is a file -&gt; files</li>
<li>åœ¨æŸä¸€ä¸ªæ—¶åˆ»ï¼Œé«˜çº§è¯­è¨€ä¹Ÿä¼šå˜æˆæ±‡ç¼–è¯­è¨€ï¼Œæ¯•ç«ŸProgrammingç»ˆç©¶ä¹Ÿå°±æ˜¯ä¸€ä¸ªWheelï¼Œå¥½åƒè·Ÿè’¸æ±½æœºæ²¡ä»€ä¹ˆåŒºåˆ«â€¦</li>
</ul>
 </div></div>

<ul>
<li><p>man 5 proc</p>
</li>
<li><p>è¿˜æ˜¯è¦è®¤çœŸè¯»manualï¼Œå®éªŒäº†åŠå¤©å¾—åˆ°çš„å‚æ•°è§£æè§„åˆ™å…¶å®åœ¨æ–‡æ¡£é‡Œå·²ç»å†™äº†ï¼Œä¸è¿‡å¥½åƒæ‰‹å†Œæ²¡æœ‰æ˜ç¡®å†™ç†”æ–­ï¼Ÿï¼ˆæ¯”å¦‚è¯´è¯»åˆ°-Vä¹‹åå°±ä¸å†è§£æäº†ï¼Œåé¢é”™è¯¯å‚æ•°ä¹Ÿä¸ç®¡äº†ï¼‰</p>
</li>
<li><p>ğŸ›<strong>æ¬ å€º</strong>ï¼šå¦‚ä½•å†™å‡ºstring robustçš„ä»£ç ï¼Ÿ</p>
</li>
<li><p>ğŸ›<strong>æ¬ å€º</strong>ï¼šå¦‚ä½•å†™å‡ºå†…å­˜å®‰å…¨çš„ä»£ç ï¼Ÿ</p>
</li>
<li><p>kthreadd pid=2 ppid=0 å†…æ ¸çº¿ç¨‹å®ˆæŠ¤è¿›ç¨‹ï¼Œè¿è¡Œåœ¨å†…æ ¸ä¸Šçš„è¿›ç¨‹,å¹¶ä¸ä¼šæ˜¾ç¤ºåœ¨pstreeé‡Œ, è€Œä¸”å‘ç°æŸ¥è¯¢åå¾—çŸ¥çº¿ç¨‹åœ¨å¯¹åº”è¿›ç¨‹æ–‡ä»¶å¤¹ä¸‹çš„taskæ–‡ä»¶å¤¹é‡Œï¼Œä¸è¿‡åœ¨/procä¸­cdç›¸åº”çš„åºå·ï¼Œä¹Ÿå¯ä»¥è¿›å»ï¼Œè™½ç„¶å®é™…ä¸Šä¸åœ¨é‚£é‡Œä¹Ÿlsä¸åˆ°ï¼Œä¸çŸ¥é“æ˜¯æ€ä¹ˆå®ç°çš„ã€‚</p>
<div class="note note-yellow icon-padding"><i class="note-icon fa-solid fa-group-arrows-rotate"></i><p>ç¾¤é™¤æˆ‘ä½¬ä¹‹åå‘ç°åŸç”Ÿpstreeä¸­æ˜¯å¯ä»¥æŒ‡å®šæ ¹çš„ï¼Œåªè¦æŒ‡å®šæ ¹ä¸º0å°±å¯ä»¥å‘ç°äº†</p>
</div></li>
</ul>
<p>ğŸ”±<strong>3.15 V1.0 æ„Ÿæƒ³</strong>ï¼š<br>å‰å‰ååå†™äº†10å‡ ä¸ªå°æ—¶ï¼Œç»ˆäºå¾—åˆ°äº†ç¬¬ä¸€ä¸ªç¨³å®šçš„ç‰ˆæœ¬ï¼Œç¡®å®æ„Ÿè§‰å¾ˆèœï¼ˆ<br>coding èƒ½åŠ›ç¡®å®ä½ä¸‹ï¼ˆè™½ç„¶æœ‰ç†Ÿæ‚‰ç¯å¢ƒçš„æ—¶é—´ï¼‰<br>ä¸è¿‡ä¹Ÿç¡®å®æ„Ÿè°¢å»å¹´ICSçš„è‡ªè¡ŒåŠ ç»ƒï¼Œä¸€å®šç¨‹åº¦ä¸Šæ²¡æœ‰è®©å·®è·æ‹‰çš„æ›´å¤§<br>ç°åœ¨æ•ˆç‡ç¡®å®è¿œæ²¡æœ‰ç¾¤ä¼—å¤§ä½¬é«˜ï¼Œä½†æ˜¯æ„Ÿè§‰èƒ½åŠ›ç¡®å®åœ¨ä¸€ç‚¹ç‚¹ç§¯ç´¯ï¼Œä¹Ÿå¸Œæœ›åé¢èƒ½è·Ÿä¸Šå¤§å®¶çš„è¿›åº¦ã€‚ã€‚ã€‚<br>åœ¨æœ‰äº›åœ°æ–¹è¸Œèº‡è¿‡å¤šï¼Œä½†å› ä¸ºå…¶å®æ²¡æœ‰å®é™…çš„ç»éªŒï¼Œæ‰€ä»¥å†™å‡ºæ¥çš„è¿˜æ˜¯ç¼ºä¹å¥å£®æ€§ã€‚ã€‚ã€‚<br>è€Œä¸”è¿™ä¹ˆç®€å•çš„åŠŸèƒ½å†™äº†å¦‚æ­¤ä¹‹å¤šè¡Œï¼Œå±å®æ˜¯å±å±±<br>ä½†<strong>æ–°çš„é£æš´ç¡®å®å·²ç»äº§ç”Ÿäº†ï¼</strong> ğŸŒªï¸ğŸŒªï¸ğŸŒªï¸</p>
<ul>
<li>32/64 robustness<br>ç¬¬ä¸€æ¬¡æäº¤æŒ‚äº†ï¼Œåº”è¯¥æ˜¯32/64çš„é—®é¢˜ï¼Œé—®äº†GPTå€¼å¾—æ³¨æ„çš„é—®é¢˜</li>
</ul>
<p><strong>32/64 Robustness Checklist:</strong><br>ğŸ”» æŒ‡é’ˆæ•´æ•°è½¬æ¢çš„æ—¶å€™ä½¿ç”¨ï¼š<code>uintptr_t</code>/<code>intptr_t</code><br>ğŸ”» ä½¿ç”¨å®šé•¿çš„<code>uint32_t</code>ç³»åˆ—æ•´å‹ï¼Œå°½é‡ä¿è¯æ•´å½¢é•¿åº¦ä¸å˜<br>ğŸ”» æ£€æŸ¥æ•°æ®å¯¹é½</p>
<ul>
<li>ä½¿ç”¨<code>#pragma pack</code>æˆ–<code>__attribute__((aligned))</code>ç­‰æŒ‡ä»¤æ¥æ§åˆ¶ç»“æ„ä½“çš„å¯¹é½æ–¹å¼ã€‚</li>
<li>åœ¨åŠ¨æ€åˆ†é…å†…å­˜æ—¶ï¼Œè€ƒè™‘ä½¿ç”¨<code>aligned_alloc</code>ã€<code>posix_memalign</code>ç­‰å‡½æ•°æ¥è·å–å¯¹é½çš„å†…å­˜å—ã€‚</li>
</ul>
<p>ğŸ”» æ³¨æ„<code>size_t</code>çš„ä½¿ç”¨<br>ğŸ”» ç¡®ä¿ä½¿ç”¨çš„ç¬¬ä¸‰æ–¹åº“å’Œå‡½æ•°çš„æ”¯æŒ<br>ğŸ”» ä½¿ç”¨é¢„å®šä¹‰å®å¦‚<code>__LP64__</code>ã€<code>_WIN64</code>ç­‰å®ç°æ¡ä»¶ç¼–è¯‘<br>ğŸ”» ä½¿ç”¨é™æ€ä»£ç åˆ†æå·¥å…·å¦‚Lintã€Cppcheckç­‰æ¥æ£€æŸ¥ã€‚</p> </div></div>




<h2 id="Lecture-3"><a href="#Lecture-3" class="headerlink" title="Lecture 3"></a>Lecture 3</h2><div class="note note-primary icon-padding"><i class="note-icon fa-solid fa-circle-arrow-right"></i><p><a class="link" target="_blank" rel="noopener" href="https://jyywiki.cn/OS/2024/lect3.md">åŠ¡å¿…æ­é…jyywikié£Ÿç”¨ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
</div>
<p>ç‰©ç†ä¸–ç•Œä¹Ÿæ˜¯çŠ¶æ€æœºï¼Œè®¡ç®—æœºç³»ç»Ÿçš„çŠ¶æ€æœºé€šè¿‡Intrå’Œå¤–ç•Œè¿æ¥èµ·æ¥ã€‚<br>å¦‚ä½•æ§åˆ¶ä¸€å°è£¸æœºï¼ŸæŠŠç¨‹åºæ”¾åˆ°RESETçŠ¶æ€é‡Œï¼<br>å›ºä»¶Firmwareï¼šç³»ç»Ÿé…ç½®ï¼Œå¼€æœºæ£€æŸ¥ï¼Œ<strong>åŠ è½½æ“ä½œç³»ç»Ÿ</strong><br>Legacy BIOS -&gt; UEFIï¼šä¸°å¯Œçš„I/Oè®¾å¤‡, PIC IPICâ€¦<br>CIHç—…æ¯’ï¼šç ´åBIOS<br>EFI åˆ†åŒºï¼Œæˆ‘ä»¬å¯ä»¥ç”¨mountæŒ‚è½½å®ƒã€‚<br>è¿˜æœ‰ä¸€ä¸ªBootç®¡ç†å·¥å…· <a class="link" target="_blank" rel="noopener" href="https://www.rodsbooks.com/refind/">rEFInd <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<ul>
<li>æ‰‹å†Œå¹¶ä¸æ˜¯å†™ç»™å­¦ç”Ÿçš„ï¼Œä½†è¦ç—›è‹¦çš„è¯»</li>
<li>AbstractMachineå¯ä»¥è®©ä½ ç»•å¼€æ‰‹å†Œ</li>
<li>æ¨¡æ‹Ÿå™¨éœ€è¦åšçš„å…¶å®å°±æ˜¯çŠ¶æ€è½¬ç§»</li>
</ul>
<div class="note-large notel-orange"><div class="notel-title"><p>Extension: Learn from the God</p>
</div><div class="notel-content"><p>GPT on the shell!<br><img lazyload="" src="/images/loading.svg" data-src="https://s2.loli.net/2024/03/06/7V1YSIWd8qiNDLz.jpg" alt="b0b8a7feeb7d08c76cf146201fc895e.jpg"></p>
 </div></div>

<p>çœ‹åˆ°3.3èŠ‚  æµ®ç°è¯¾ä¸Šä»£ç </p>
<h2 id="Lecture-4"><a href="#Lecture-4" class="headerlink" title="Lecture 4"></a>Lecture 4</h2><div class="note note-primary icon-padding"><i class="note-icon fa-solid fa-circle-arrow-right"></i><p><a class="link" target="_blank" rel="noopener" href="https://jyywiki.cn/OS/2024/lect4.md">åŠ¡å¿…æ­é…jyywikié£Ÿç”¨ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
</div>
<ul>
<li>Coq è¯­è¨€ -&gt; ç»è¿‡<a class="link" target="_blank" rel="noopener" href="https://cacm.acm.org/news/formal-software-verification-measures-up/">å½¢å¼åŒ–éªŒè¯ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li>
<li><strong>è¿™é—¨è¯¾çš„é€»è¾‘æ€è·¯</strong>ï¼šå»ºæ¨¡-&gt;ç”¨Pythonå®ç°è¿™ä¸ªæ¨¡å‹çš„Toyï¼ˆèƒ½å®ç°çš„åŸå› ï¼šæ“ä½œç³»ç»Ÿå°±æ˜¯ä¸€ä¸ªçŠ¶æ€æœºï¼ï¼‰-&gt;å¯¹æ¯”Toyå’ŒçœŸå®æ“ä½œç³»ç»Ÿçš„åŒºåˆ«-&gt;è®¤è¯†çœŸå®æ“ä½œç³»ç»Ÿçš„æ€§è´¨</li>
<li>å¦‚ä½•è®¾ç½®ï¼ŸæŠŠæ‰€æœ‰<strong>æ€§è´¨</strong>éƒ½æ˜¾å¼çš„assertionå‡ºæ¥ã€‚</li>
<li>æ“ä½œç³»ç»Ÿçš„ç†è§£ï¼šç®¡ç†çŠ¶æ€æœºçš„çŠ¶æ€æœº, æœ€æ—©çš„å¹¶å‘ç¨‹åº</li>
<li>é‚£æˆ‘ä»¬å¦‚ä½•æ¥å®ç°ä¸€ä¸ªâ€œçŠ¶æ€æœºçš„çŠ¶æ€æœºâ€ç©å…·å‘¢ï¼Ÿå¦‚æœæœ‰ç®€å•çš„å·¥å…·å°±å¥½äº†ï¼â€”â€”Generator</li>
<li>æ•°å­¦è§†è§’ä¸‹ï¼ŒçŠ¶æ€æœºå°±æ˜¯ä¸€ä¸ªå›¾ï¼Œå› æ­¤ç³»ç»Ÿçš„çŠ¶æ€å°±æ˜¯å›¾ï¼Œå› æ­¤å°±å¯ä»¥ä½¿ç”¨å›¾è®ºæ–¹æ³•ï¼Œæ¯”æ–¹è¯´ï¼Œç”¨å¹¿åº¦ä¼˜å…ˆæœç´¢éªŒè¯ç¨‹åº/ç³»ç»Ÿçš„æ­£ç¡®æ€§ã€‚</li>
</ul>
<p><strong>å¾…å®Œæˆï¼Œè·‘ä¸€ä¸‹ 30lineOS å¤ä¹ Python Geneï¼Œä½™è€…å®Œæˆ</strong></p>
<p>GDB TUI?</p>
<p>ewigooooooojfewighwiorhgihiihrhfuwdhuhhudhhfhuhdhfhcndjncjnjdncdnufewigooooooojfewighwiorhgihiihrhfuwdhuhhudhhfhuhdhfhcndjncjnjdncdnufewigooooooojfewighwiorhgihiihrhfuwdhuhhudhhfhuhdhfhcndjncjnjdncdnufewigooooooojfewighwiorhgihiihrhfuwdhuhhudhhfhuhdhfhcndjncjnjdncdnufewigooooooojfewighwiorhgihiihrhfuwdhuhhudhhfhuhdhfhcndjncjnjdncdnufewigooooooojfewighwiorhgihiihrhfuwdhuhhudhhfhuhdhfhcndjncjnjdncdnufewigooooooojfewighwiorhgihiihrhfuwdhuhhudhhfhuhdhfhcndjncjnjdncdnufewigooooooojfewighwiorhgihiihrhfuwdhuhhudhhfhuhdhfhcndjncjnjdncdnufewigooooooojfewighwiorhgihiihrhfuwdhuhhudhhfhuhdhfhcndjncjnjdncdnufewigooooooojfewighwiorhgihiihrhfuwdhuhhudhhfhuhdhfhcndjncjnjdncdnufewigooooooojfewighwiorhgihiihrhfuwdhuhhudhhfhuhdhfhcndjncjnjdncdnufewigooooooojfewighwiorhgihiihrhfuwdhuhhudhhfhuhdhfhcndjncjnjdncdnufewigooooooojfewighwiorhgihiihrhfuwdhuhhudhhfhuhdhfhcndjncjnjdncdnufewigooooooojfewighwiorhgihiihrhfuwdhuhhudhhfhuhdhfhcndjncjnjdncdnufewigooooooojfewighwiorhgihiihrhfuwdhuhhudhhfhuhdhfhcndjncjnjdncdnufewigooooooojfewighwiorhgihiihrhfuwdhuhhudhhfhuhdhfhcndjncjnjdncdnufewigooooooojfewighwiorhgihiihrhfuwdhuhhudhhfhuhdhfhcndjncjnjdncdnufewigooooooojfewighwiorhgihiihrhfuwdhuhhudhhfhuhdhfhcndjncjnjdncdnufewigooooooojfewighwiorhgihiihrhfuwdhuhhudhhfhuhdhfhcndjncjnjdncdnufewigooooooojfewighwiorhgihiihrhfuwdhuhhudhhfhuhdhfhcndjncjnjdncdnufewigooooooojfewighwiorhgihiihrhfuwdhuhhudhhfhuhdhfhcndjncjnjdncdnufewigooooooojfewighwiorhgihiihrhfuwdhuhhudhhfhuhdhfhcndjncjnjdncdnufewigooooooojfewighwiorhgihiihrhfuwdhuhhudhhfhuhdhfhcndjncjnjdncdnufu</p>
<h2 id="Lecture-5-C"><a href="#Lecture-5-C" class="headerlink" title="Lecture 5 (C)"></a>Lecture 5 (C)</h2><div class="note note-primary icon-padding"><i class="note-icon fa-solid fa-circle-arrow-right"></i><p><a class="link" target="_blank" rel="noopener" href="https://jyywiki.cn/OS/2024/lect5.md">åŠ¡å¿…æ­é…jyywikié£Ÿç”¨ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
</div>
<ul>
<li>å¤šçº¿ç¨‹ç¨‹åºï¼šå¤šä¸ªçŠ¶æ€æœºå…±äº«å†…å­˜ï¼Œæœ‰ç§æœ‰çš„ï¼ˆCï¼šæ ˆåŒº/Assembleï¼šå¯„å­˜å™¨ï¼‰</li>
</ul>
<div class="note note-green icon-padding"><i class="note-icon fa-solid fa-bolt"></i><p>æ ¸å¿ƒæ–¹æ³•è®ºï¼š<strong>Questioning and Proofing</strong><br>å¯¹ç»™å‡ºçš„ç»“è®ºæŒæ€€ç–‘æ€åº¦ï¼Œå¹¶ä¸”è¯•ç€å»æ„é€ æ¡ˆä¾‹å»éªŒè¯ã€‚ï¼ˆHands dirtyâ€¦ï¼‰</p>
</div>

<ul>
<li>å¦‚ä½•è¯æ˜å…±äº«å†…å­˜ï¼Ÿç®€å•ï¼</li>
<li>å¦‚ä½•è¯æ˜ä¸å…±äº«æ ˆåŒºï¼Ÿ<br>æ‰¾åˆ°æ ˆåŒºï¼ŸæŒ‡å‘æ ˆåŒºçš„â€œæŒ‡é’ˆâ€ï¼-&gt;å±€éƒ¨å˜é‡å–åœ°å€<br>å¦‚ä½•å¤§è‡´ç”»å‡ºæ ˆåŒºèŒƒå›´ï¼Ÿ stack overflow! â€”&gt; default 8MB</li>
</ul>
<div class="note note-cyan icon-padding"><i class="note-icon fa-solid fa-user-secret"></i><p>é˜…è¯»ä»£ç ï¼š<a class="link" target="_blank" rel="noopener" href="https://github.com/Jackcuii/jyy-codes-test-and-read/blob/master/thread-lib/thread.h">æœ€å°çº¿ç¨‹åº“ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>ç®€åŒ–äº†çº¿ç¨‹API</p>
</div>

<blockquote>
<p>mosaicçš„ä½¿ç”¨ï¼šç›´æ¥è¿èµ·æ¥å³å¯ï¼Œç®¡é“å–‚ç»™collect.pyè¿™æ ·å°±å¯ä»¥æ”¶é›†ç»“æœã€‚</p>
</blockquote>
<div class="note-large notel-orange"><div class="notel-title"><p>Extention: LLM</p>
</div><div class="notel-content"><p>LLaMA.cpp: Support run LLM on CPU (OpenSource)<br><a class="link" target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/622450960">https://zhuanlan.zhihu.com/p/622450960 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
 </div></div>



<ul>
<li><p><strong>éœ€è¦reading: Quickguide GDBè°ƒè¯•å¹¶å‘ç¨‹åº</strong></p>
</li>
<li><p>å¼€æ”¾<strong>ä½ çš„</strong>æ€æƒ³ï¼šâ€œæ”¾å¼ƒç¼–ç¨‹åŸå­æ€§çš„å‡è®¾â€ï¼Œè¿›è¡Œä¸­çš„çŠ¶æ€æœºä¼šè¢«æ”¹å˜ï¼</p>
<ul>
<li>åœ¨ä¸€ä¸ªå¤„ç†å™¨çš„å¤šçº¿ç¨‹æ„ä¹‰ä¸‹ï¼Œè¯­å¥çš„åŸå­æ€§å·²ç»ä¸å­˜åœ¨äº†</li>
<li>åœ¨å¤šå¤„ç†å™¨çš„æ„ä¹‰ä¸‹ï¼Œè¿ä¸€æ¡æ±‡ç¼–æŒ‡ä»¤çš„åŸå­æ€§éƒ½ä¸å­˜åœ¨äº†</li>
</ul>
</li>
<li><p>1+1éƒ½å†™ä¸å¯¹äº†ï¼Ÿç¡®å®ï¼Œè€Œä¸”å‡ ä¹æ²¡äººèƒ½å†™å¯¹ Dekkerâ€™s Algorithm æ˜¯ç¬¬ä¸€ä¸ª<br>Question 1+1: Nä¸ªthreads, sumæœ€å°æ˜¯ï¼Ÿ 2ï¼ä»»æ„å¤šä¸ªçº¿ç¨‹éƒ½æ˜¯ï¼</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Thread 1 | Thread 2</span><br><span class="line">load 0   | load 0</span><br><span class="line">store 1  |</span><br><span class="line">load 1   |</span><br><span class="line">store 2  |</span><br><span class="line">         | store 1</span><br><span class="line">load 1   | </span><br><span class="line">         | load 1</span><br><span class="line">         | store 2</span><br><span class="line">         | load 2</span><br><span class="line">         | store 3</span><br><span class="line">store 2  |</span><br></pre></td></tr></table></figure></div></li>
<li><p>çº¿ç¨‹å®‰æ’æ˜¯ä»¥ä¸€ä¸ªNP-Completeé—®é¢˜ï¼Œ<em>LLMçº§åˆ«çš„ç›´è§‰</em> ä¹Ÿä¸èƒ½è§£å†³ï¼</p>
</li>
</ul>
<hr>
<ul>
<li>æ›´å¤§çš„éº»çƒ¦ï¼š<strong>ç¼–è¯‘å™¨</strong>ä¹Ÿæ˜¯è¿™ä¹ˆè®¤ä¸ºçš„ï¼<br>å›é¡¾ç¼–è¯‘ä¼˜åŒ–ï¼Œç°åœ¨æ¯ä¸€æ¡æŒ‡ä»¤ä¹‹é—´éƒ½å¯èƒ½æ˜¯ç³»ç»Ÿè°ƒç”¨ï¼<br>å…±äº«å†…å­˜çš„èƒŒæ™¯ä¸‹ï¼Œå‡ ä¹ä»»ä½•ç¨‹åºï¼Œéƒ½æ˜¯â€œä¸å¯ä¼˜åŒ–çš„â€ï¼<br><em>â€˜Heisenbugâ€™</em>: Copilotï¼šâ€œä¸€ä¸ªbugï¼Œä½ è¯•å›¾ä¿®å¤å®ƒï¼Œå®ƒå°±æ¶ˆå¤±äº†ï¼â€ <ul>
<li>æ›´å¯æ€•çš„æ˜¯å½“ç¼–è¯‘å™¨æ‰§è¡Œäº†ä¼˜åŒ–ï¼Œå¯èƒ½ä¼šæŠŠå¹¶å‘é”™è¯¯éšè—èµ·æ¥ï¼<br>-O1 ç¨³å®š 10000000ï¼šæŠŠå’Œä¼˜åŒ–åˆ°å¯„å­˜å™¨é‡Œäº†ï¼Œåªæœ€åå†™å†…å­˜äº†ä¸€æ¬¡<br>-O2 ç¨³å®š 20000000: ç›´æ¥ç¼–è¯‘æˆä¸€ä¸ªåŠ äº†ï¼Œé‡åˆ°çš„æ¦‚ç‡å¾ˆå°</li>
<li>waiting for flag bug:<br>while(!flag);<br>â€œç­‰å¦ä¸€ä¸ªçº¿ç¨‹ä¸¾èµ·æ——å­â€<br>ä¹Ÿä¸è¡Œï¼ç¼–è¯‘å™¨è§†è§’ï¼šè¦ä¹ˆç›´æ¥è¿‡ï¼Œ<strong>è¦ä¹ˆæ­»å¾ªç¯</strong>ã€‚<ul>
<li>è§£å†³ï¼ˆä¹Ÿæ˜¯å¾ˆå¤šå¹¶å‘çš„è§£å†³åŠæ³•ï¼‰ï¼šæ’å…¥ä¸å¯ä¼˜åŒ–ä»£ç ï¼Œè§jyyppt/volatile</li>
<li><strong>è€Œæœ¬è¯¾ç¨‹å»ºè®®ï¼šåŠ é”ï¼</strong></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="note-large notel-red"><div class="notel-title"><p>Spicy</p>
</div><div class="notel-content"><ul>
<li>æ›´æ›´æ›´å¤§çš„éº»çƒ¦ï¼š<strong>å¤„ç†å™¨</strong>ä¹Ÿæ˜¯è¿™ä¹ˆè®¤ä¸ºçš„ï¼ï¼ˆå¤„ç†å™¨ä¹Ÿæ˜¯ç¼–è¯‘å™¨ï¼‰<br>å¦‚æœå•çº¿ç¨‹ä¹±åºç­‰æ•ˆï¼Œå¤„ç†å™¨å°±å¯ä»¥ä¹±åºæ‰§è¡Œã€‚<br>å¤„ç†å™¨å–å‡ºå¤šæ¡æŒ‡ä»¤ï¼Œç„¶ååˆ¤æ–­æ˜¯å¦å†²çªã€‚æ¬¸ï¼Ÿè¿™ä¸å°±æ˜¯ç¼–è¯‘å™¨å—ï¼ŒåŒæ ·ä¼šå¯¼è‡´å¹¶å‘é”™è¯¯ï¼<ul>
<li>â€œç›¸å¯¹è®ºæ•ˆåº”â€ï¼šå¤æ‚çš„ç›¸å¯¹æ—¶åº<br>å¤šå¤„ç†å™¨çš„èƒŒæ™¯ä¸‹ï¼Œå…±äº«å†…å­˜å¹¶ä¸æ˜¯ç®€å•å…±äº«â€œåŒä¸€å—â€ï¼Œä¼šå‘ç°ç¨‹åºæ‰§è¡Œçš„ç»å¯¹é¡ºåºå®Œå…¨ä¸å­˜åœ¨äº†ï¼Œå¯¹äºä¸åŒçš„CPUï¼Œè§‚æµ‹åˆ°çš„æ—¶åºå¯èƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼ˆå› ä¸ºå¤šçº§ç¼“å­˜å¤æ‚çš„å†™å…¥é€»è¾‘ï¼ˆcopy-on-write ä¹‹ç±»çš„ï¼‰ï¼‰ã€‚</li>
<li>model checker éƒ½å¤±æ•ˆäº†<br>å› ä¸ºmodel checkeræ˜¯åŸºäºâ€œä¸€å—å…±äº«å†…å­˜â€å»ºæ¨¡çš„<br>å›°éš¾çš„ memory model (æ¯”å¦‚x86çš„ write buffer)<ul>
<li>å¦‚æœmodelä¸åŒï¼Œå°±å¾ˆéš¾ç›¸äº’æ¨¡æ‹Ÿï¼Œæ¯”å¦‚ARMå’Œx86ä¹‹é—´</li>
</ul>
</li>
</ul>
</li>
</ul>
 </div></div>


<div class="note-large notel-blue"><div class="notel-title"><p>OSTEP Chapter 25,26,27</p>
</div><div class="notel-content"><ul>
<li>PCB(Process Control Block) v.s. TCB(Thread Control Block)</li>
<li>objdumpå‚æ•°ï¼š-g</li>
<li><strong>å·¥å…·ä½¿ç”¨valgrind, purify, helgrind</strong></li>
<li>pthreadåº“åŸºç¡€<ul>
<li>pthread_create åˆ›å»ºçº¿ç¨‹ </li>
<li>pthread_join ç­‰å¾…çº¿ç¨‹è¿”å›ï¼ˆå¹¶ä¸æ˜¯æ‰€æœ‰çš„åœºæ™¯éƒ½éœ€è¦ï¼‰</li>
</ul>
</li>
<li>pthread lock<ul>
<li>pthread_mutex_init</li>
<li>pthread_mutex_lock</li>
<li>pthread_mutex_unlock</li>
<li>pthread_mutex_destroy</li>
<li>pthread_mutex_trylock(ä¸€èˆ¬ä¸è¦ç”¨)</li>
<li>pthread_mutex_timedlock(ä¸€èˆ¬ä¸è¦ç”¨)</li>
</ul>
</li>
<li>pthread cond var æš‚æ—¶ç•¥è¿‡</li>
</ul>
<p><strong>Multithreading Checklist</strong>:<br>ğŸ”» </p>
 </div></div>


<h2 id="Lecture-6-C"><a href="#Lecture-6-C" class="headerlink" title="Lecture 6 (C)"></a>Lecture 6 (C)</h2><div class="note note-primary icon-padding"><i class="note-icon fa-solid fa-circle-arrow-right"></i><p><a class="link" target="_blank" rel="noopener" href="https://jyywiki.cn/OS/2024/lect6.md">åŠ¡å¿…æ­é…jyywikié£Ÿç”¨ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
</div>
<p>â€˜sequential creatureâ€™çš„åå‡»ï¼š<br>äº’æ–¥ï¼ä¸å…è®¸å¹¶å‘ï¼ç»™å®ƒä»¬ä¸Šé”ï¼Œè®©çŠ¶æ€æœºä¸Šçš„ä¸€éƒ¨åˆ†ç¼©æˆä¸€ä¸ªç‚¹ï¼<br>å¦‚æœéƒ½ä¸è®©å¹¶å‘äº†ï¼Ÿé‚£è¿˜å¹¶å‘å¹²ä»€ä¹ˆï¼Ÿ<br>è¿ç®—æ˜¯å¯ä»¥å¹¶è¡Œçš„ã€‚å±€éƒ¨æ€§åŸç†ï¼ˆç»å…¸ç‰©ç†ï¼šâ€œç‰©ä½“å¯¹ç›¸é‚»çš„ç‰©ä½“äº§ç”Ÿå½±å“éœ€è¦æ—¶é—´ï¼â€ï¼‰ï¼Œå±€éƒ¨çš„è®¡ç®—éƒ½å¯ä»¥ç‹¬ç«‹çš„è¿›è¡Œï¼Œåªéœ€è¦è°¨æ…çš„å¤„ç†åˆ†å—çš„è¾¹ç•Œã€‚å¯ä»¥è®¤ä¸ºä¸èƒ½å¹¶å‘çš„<strong>ä»»åŠ¡</strong>éƒ¨åˆ†è¿œè¿œå°‘äºå¯ä»¥å¹¶å‘çš„ã€‚</p>
<p>å¦‚ä½•äº’æ–¥ï¼Ÿå¯¹äºä¸€ä¸ªå¤„ç†å™¨ï¼Œå…³ä¸­æ–­å°±å¯ä»¥äº†ï¼<br>ä½†å½“æŸä¸€ä¸ªç¨‹åºå¡æ­»äº†ï¼ŒOSå°±å¡æ­»äº†ã€‚<br>æ€ä¹ˆåŠï¼Ÿå¤–éƒ¨ç›‘æ§ï¼Œåˆ©ç”¨NMIæ¥å¤–éƒ¨ç›‘æ§OSæ˜¯å¦æ‰§è¡Œæ­£å¸¸ã€‚ï¼ˆå¦‚é‡ç½®å®šæ—¶å™¨ç­‰ï¼‰<br>å› æ­¤æ“ä½œç³»ç»Ÿç»Ÿæ²»äº†ä¸­æ–­ï¼Œç¦æ­¢ç”¨æˆ·ç¨‹åºæ§åˆ¶ä¸­æ–­ã€‚</p>
<ul>
<li>æ‚²è§‚çš„Amdahlâ€™s Law: å¦‚æœä½ æœ‰<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="3.441ex" height="2.262ex" role="img" focusable="false" viewBox="0 -750 1521 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(500,0)"><g data-mml-node="mo"><path data-c="2F" d="M423 750Q432 750 438 744T444 730Q444 725 271 248T92 -240Q85 -250 75 -250Q68 -250 62 -245T56 -231Q56 -221 230 257T407 740Q411 750 423 750Z"></path></g></g><g data-mml-node="mi" transform="translate(1000,0)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g></g></g></svg></mjx-container>çš„ä»£ç æ˜¯ä¸èƒ½å¹¶è¡Œçš„ï¼Œé‚£ä¹ˆ <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.798ex;" xmlns="http://www.w3.org/2000/svg" width="8.754ex" height="2.89ex" role="img" focusable="false" viewBox="0 -924.8 3869.3 1277.6"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D447" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path></g><g data-mml-node="TeXAtom" transform="translate(617,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="221E" d="M55 217Q55 305 111 373T254 442Q342 442 419 381Q457 350 493 303L507 284L514 294Q618 442 747 442Q833 442 888 374T944 214Q944 128 889 59T743 -11Q657 -11 580 50Q542 81 506 128L492 147L485 137Q381 -11 252 -11Q166 -11 111 57T55 217ZM907 217Q907 285 869 341T761 397Q740 397 720 392T682 378T648 359T619 335T594 310T574 285T559 263T548 246L543 238L574 198Q605 158 622 138T664 94T714 61T765 51Q827 51 867 100T907 217ZM92 214Q92 145 131 89T239 33Q357 33 456 193L425 233Q364 312 334 337Q285 380 233 380Q171 380 132 331T92 214Z"></path></g></g></g><g data-mml-node="mo" transform="translate(1651.9,0)"><path data-c="3E" d="M84 520Q84 528 88 533T96 539L99 540Q106 540 253 471T544 334L687 265Q694 260 694 250T687 235Q685 233 395 96L107 -40H101Q83 -38 83 -20Q83 -19 83 -17Q82 -10 98 -1Q117 9 248 71Q326 108 378 132L626 250L378 368Q90 504 86 509Q84 513 84 520Z"></path></g><g data-mml-node="mfrac" transform="translate(2707.7,0)"><g data-mml-node="msub" transform="translate(220,446.1) scale(0.707)"><g data-mml-node="mi"><path data-c="1D447" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path></g><g data-mml-node="mn" transform="translate(617,-150) scale(0.707)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g><g data-mml-node="mi" transform="translate(396.6,-345) scale(0.707)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g><rect width="921.6" height="60" x="120" y="220"></rect></g></g></g></svg></mjx-container></li>
<li>ä¹è§‚çš„Gustafsonâ€™s Law (çš„æ›´ç»†è‡´ç‰ˆæœ¬): å¹¶è¡Œè®¡ç®—æ€»æ˜¯èƒ½å®ç°çš„ <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -1.091ex;" xmlns="http://www.w3.org/2000/svg" width="13.834ex" height="3.183ex" role="img" focusable="false" viewBox="0 -924.8 6114.4 1407"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D447" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path></g><g data-mml-node="mi" transform="translate(617,-150) scale(0.707)"><path data-c="1D45D" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g></g><g data-mml-node="mo" transform="translate(1300.5,0)"><path data-c="3C" d="M694 -11T694 -19T688 -33T678 -40Q671 -40 524 29T234 166L90 235Q83 240 83 250Q83 261 91 266Q664 540 678 540Q681 540 687 534T694 519T687 505Q686 504 417 376L151 250L417 124Q686 -4 687 -5Q694 -11 694 -19Z"></path></g><g data-mml-node="msub" transform="translate(2356.2,0)"><g data-mml-node="mi"><path data-c="1D447" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path></g><g data-mml-node="TeXAtom" transform="translate(617,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="221E" d="M55 217Q55 305 111 373T254 442Q342 442 419 381Q457 350 493 303L507 284L514 294Q618 442 747 442Q833 442 888 374T944 214Q944 128 889 59T743 -11Q657 -11 580 50Q542 81 506 128L492 147L485 137Q381 -11 252 -11Q166 -11 111 57T55 217ZM907 217Q907 285 869 341T761 397Q740 397 720 392T682 378T648 359T619 335T594 310T574 285T559 263T548 246L543 238L574 198Q605 158 622 138T664 94T714 61T765 51Q827 51 867 100T907 217ZM92 214Q92 145 131 89T239 33Q357 33 456 193L425 233Q364 312 334 337Q285 380 233 380Q171 380 132 331T92 214Z"></path></g></g></g><g data-mml-node="mo" transform="translate(3952.6,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mfrac" transform="translate(4952.8,0)"><g data-mml-node="msub" transform="translate(220,446.1) scale(0.707)"><g data-mml-node="mi"><path data-c="1D447" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path></g><g data-mml-node="mn" transform="translate(617,-150) scale(0.707)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g><g data-mml-node="mi" transform="translate(403,-345) scale(0.707)"><path data-c="1D45D" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g><rect width="921.6" height="60" x="120" y="220"></rect></g></g></g></svg></mjx-container></li>
</ul>
<p>å°è¯•ç”¨è½¯ä»¶ï¼ˆç®—æ³•ï¼‰å®ç°äº’æ–¥ï¼š</p>
<ul>
<li>Dekkerâ€™s Algorithm</li>
<li>Petersonâ€™s Algorithm<ul>
<li>å‡è®¾è¯»å†™è¿‡ç¨‹æ˜¯åŸå­çš„ï¼Œä»»ä½•æ—¶åˆ»éƒ½å¯ä»¥æ‰§è¡Œload/store</li>
<li>è¿‡ç¨‹<ul>
<li>å¸Œæœ›è¿›å•æ‰€ï¼šä¸¾æ——å­ï¼ŒæŠŠå¯¹æ–¹çš„åå­—è´´åœ¨é—¨ä¸Š</li>
<li>ä¹‹åçœ‹å¯¹é¢ï¼šä¸¾æ²¡ä¸¾æ——ï¼Œé—¨ä¸Šæ˜¯ä¸æ˜¯è‡ªå·±çš„åå­—</li>
</ul>
</li>
<li>ä¿è¯äº†ä»»æ„æ‰“æ–­çš„æ­£ç¡®æ€§ã€‚ä½ æ€ä¹ˆçŸ¥é“çš„ï¼ŸMosaicï¼</li>
</ul>
</li>
</ul>
<div class="note note-green icon-padding"><i class="note-icon fa-solid fa-bolt"></i><p>æ ¸å¿ƒæ–¹æ³•è®ºï¼š<strong>Let model checker tell you!</strong><br>ä¸å…¶æ— æ„è¯†çš„ççŒœï¼Œä¸å¦‚è®©Mosaicæ¥å‘Šè¯‰ä½ ç­”æ¡ˆï¼<br>å¦‚ä½•çŸ¥é“è¿™ä¸ªçŠ¶æ€æœºçš„æ€§è´¨ï¼Œåˆ«å¿˜äº†å›¾è®ºï¼<br><strong>æˆ‘ä»¬å­¦ä¹ å’Œç ”ç©¶çš„æ–¹æ³•è®ºæ”¹å˜äº†</strong><br><img lazyload="" src="/images/loading.svg" data-src="https://s2.loli.net/2024/03/18/GLYoIMUAia6RQ5H.png" width="600"><br>æˆ‘ä»¬åªè¦å‘æ•£å’Œè´¨ç–‘ï¼Œæå‡ºçŒœæƒ³ï¼è®©å¥½çš„å·¥å…·å‘Šè¯‰ä½ å¯¹é”™ï¼<br><img lazyload="" src="/images/loading.svg" data-src="https://s2.loli.net/2024/03/18/iHCg2x5um3BOyMF.png" width="250"><br><img lazyload="" src="/images/loading.svg" data-src="https://s2.loli.net/2024/03/18/dPsJ9vR5aACQmDH.png" width="200"><br>å†å»æƒ³ä¸ºä»€ä¹ˆã€‚</p>
</div>

<blockquote>
<p>ä¸ºä»€ä¹ˆäººç±»çš„â€œç­‰åœ¨å•æ‰€é—¨å£â€ä¸è¡Œï¼Ÿ<br>ä¸èƒ½åŒæ—¶â€œçœ‹â€å’Œâ€œå†™â€ï¼ˆæ­£å› ä¸ºä¸èƒ½åŒæ—¶ï¼Œæ‰€ä»¥ä¸­é—´å¯èƒ½ä¼šè¢«æ’å…¥ï¼‰<br>è¦ä¹ˆé—­ç€çœ¼ç›å†™ï¼Œè¦ä¹ˆèƒŒç€æ‰‹çœ‹ï¼</p>
</blockquote>
<p>ä¸è¡Œæ€ä¹ˆåŠï¼Œåœ¨å…³é”®åŒºstop-the-worldï¼<br>é—®é¢˜æ˜¯ï¼š??</p>
<ul>
<li>åªèƒ½æ“ä½œç³»ç»Ÿå¯ä»¥stop-the-worldï¼ˆå…³ä¸­æ–­ï¼‰</li>
<li>å¤šå¤„ç†å™¨ä¹Ÿç”¨ä¸äº†</li>
</ul>
<p>è½¯ä»¶è§£å†³å¦‚æ­¤å›°éš¾ï¼Œç”¨ç¡¬ä»¶æ¥è§£å†³å°±å¯ä»¥äº†ï¼<br>ç¡¬ä»¶å®ç°çš„åŸå­æŒ‡ä»¤ <strong>é‡å¬ä¸€ä¸‹è¿™é‡Œ</strong><br>ç”¨ç¡¬ä»¶æŠŠçœ‹å’Œå†™å˜æˆåŒæ—¶ï¼<br>ç»™æˆ‘<strong>ä¸€ç‚¹</strong>stop-the-worldçš„æœºä¼šï¼Œä¸€ä¸ªload/store.</p>
<hr>
<p>Petersonè§£å†³é—®é¢˜äº†å—ï¼Ÿæ²¡æœ‰çš„<br>æ€ä¹ˆåŠï¼Ÿè¿˜æ˜¯è¦ä¸–ç•Œåœä¸‹ï¼ä¸è¿‡åœä¸‹ä¸€å°ä¼šã€‚</p>
<p>å¸¦æ¯”è¾ƒçš„exchange<br>ç»†èŠ‚ï¼šlhjå¤šå¤„ç†å™¨</p>
<p>TSX Memory</p>
<p>ç›¸æ¯”äºä¸Šé¢çš„è‡ªæ—‹é”ï¼Œå®é™…çš„è‡ªæ—‹é”æ›´ä¸ºå¤æ‚<br>ç”¨æˆ·æ€çš„è‡ªæ—‹é”ä¼šå¯¼è‡´èµ„æºæµªè´¹ï¼</p>
<div class="note-large notel-blue"><div class="notel-title"><p>OSTEP Chapter 28</p>
</div><div class="notel-content"><ul>
<li>mutual exclusion<ul>
<li>disable interruption(simple but bad, as above)</li>
<li>atomic instr:<br>differs in different Arch</li>
</ul>
</li>
<li>fairness</li>
<li>performance</li>
</ul>
 </div></div>



<h2 id="Lecture-7-C"><a href="#Lecture-7-C" class="headerlink" title="Lecture 7 (C)"></a>Lecture 7 (C)</h2><p>å¦‚ä½•ä¿è¯å¤§å®¶çš„è¿è¡Œï¼Ÿå®ç°å¤šæŠŠé”ã€‚<br>è¿˜è¦ä¿è¯å½“ä¸€ä¸ªè§£é”æ—¶ï¼Œå®ƒæ‰€åšçš„å†™å¿…é¡»éƒ½æ˜¯å¯¹å…¶ä»–çº¿ç¨‹å¯è§çš„ï¼ˆæ€ä¹ˆå®ç°å…ˆä¸ç”¨ç®¡ï¼Œæ¡†æ¶é‡Œå¸®ä½ å®ç°äº†ï¼‰<br>è™½ç„¶é”å¾ˆå¥½ç”¨ï¼Œä½†å¹¶ä¸å®¹æ˜“æ­£ç¡®å¤„ç†é”ã€‚<br>å®¹æ˜“å‡ºç°å¿˜è®°åŠ é”äº†ï¼Œä»è€Œé€ æˆæ•°æ®ç«äº‰(Data race)<br><strong>Warningï¼šä¸€å®šä¼šé‡åˆ°å¹¶å‘é”™è¯¯</strong></p>
<hr>
<p>åœ¨ç°å®è¿è¡Œä¸­ï¼Œå¹¶ä¸æ­¢å¦‚æ­¤ï¼Œè¿˜æœ‰ä¸­æ–­ï¼<br>å½“ä½ è¿›å…¥ä¸´ç•ŒåŒºï¼Œè§¦å‘ä¸­æ–­ï¼Œå†è¯•å›¾è¿›å…¥ä¸´ç•ŒåŒºï¼Œæ­¤æ—¶å·²ç»ä¸Šé”äº†ï¼Œæ— æ³•é€€å‡ºï¼å› æ­¤ä»…æœ‰è‡ªæ—‹æ˜¯ä¸å¯¹çš„ã€‚</p>
<div class="note note-green icon-padding"><i class="note-icon fa-solid fa-bolt"></i><p>å°½é‡ä¸è¦<strong>ç”¨ç›´è§‰</strong>å»å†™ä»£ç ï¼Œå†™é”™å†åˆ â€¦.</p>
</div>
<ul>
<li><p>ç›´è§‚çš„æƒ³æ³•ï¼šcli -&gt; lock() -&gt; â€¦ -&gt; unlock() -&gt; sti</p>
</li>
<li><p>ä¸€ä¸ªé”è¿‡ç¨‹ä¸­å¯èƒ½ä¼šè°ƒç”¨ä¸­æ–­å†æ¬¡è¿è¡Œè¿™æ®µä»£ç ï¼Œé‚£ä¹ˆå°±æ— æ³•è·å¾—è¿™ä¸ªé”ï¼šé™·å…¥æ­»é”ï¼</p>
</li>
<li><p>å¤šä¸ªé”å¯ä»¥åµŒå¥—å’Œç©¿æ’ï¼Œä½†cliå’Œstiåªæœ‰ä¸€ä¸ªï¼Œæ€ä¹ˆä¿è¯<strong>å›åˆ°ä»å‰</strong>ï¼Ÿ<br>ä¿è¯ä¸­æ–­çŠ¶æ€ä¸å˜è¿™ä»¶äº‹ä¸å®¹æ˜“ï¼šå¿…é¡»è¦ä¿å­˜ä¸­æ–­çŠ¶æ€ã€‚ä¿å­˜åœ¨å“ªï¼Ÿ<br>æ¯æ¬¡å…³ä¸­æ–­éƒ½+1ï¼Œå¼€ä¸­æ–­-1ï¼Œç±»ä¼¼æ¯æ¬¡åµŒå¥—éƒ½æŠŠä¸­æ–­çŠ¶æ€å­˜åˆ°ä¸€ä¸ªæ ˆé‡Œï¼Œ<strong>æ¯ä¸ªCPU</strong>éƒ½ç»´æŠ¤<br><strong>æ¨èé˜…è¯»ï¼šXV6</strong></p>
<div class="note note-cyan icon-padding"><i class="note-icon fa-solid fa-user-secret"></i><p>å¾ˆå¥½çš„spinlockä»£ç <br>ä¸€ä¸ªå¯ç¤ºï¼šå¤šå†™æ£€æŸ¥ï¼ï¼<br>å¦å¤–jyyå†™çš„mainé‡Œé¢ä¹Ÿæœ‰å¾ˆå¤šå€¼å¾—å­¦ä¹ çš„ä¸œè¥¿ã€‚</p>
</div></li>
</ul>
<div class="note note-yellow icon-padding"><i class="note-icon fa-solid fa-group-arrows-rotate"></i><p>ç¾¤é™¤æˆ‘ä½¬ï¼š<br>å…³äºspinlockçš„mainåœ¨æœ¬åœ°è¿è¡Œç»“æœä¸æ­£ç¡®çš„é—®é¢˜ï¼š<br>è¿˜æœ‰å°±æ˜¯TCGæ˜¯ä»€ä¹ˆä¸œè¥¿ï¼Ÿ</p>
</div>

<div class="note note-green icon-padding"><i class="note-icon fa-solid fa-bolt"></i><p>è·³å‡ºfast-passçš„<strong>æŠ•æœº</strong>æ€ç»´ï¼šå³<strong>å‡è®¾</strong>è‡ªå·±çš„ä»£ç æ˜¯å¯¹çš„ã€‚<br>ä»¥åå°±æ²¡æœ‰äººå‘Šè¯‰ä½ å¯¹ä¸å¯¹äº†ï¼è€Œä¸”ä½ çš„æœªæµ‹ä»£ç è¶Šæ¥è¶Šå¯èƒ½ä¸å¯¹ï¼</p>
</div>


<div class="note-large notel-red"><div class="notel-title"><p>Spicy</p>
</div><div class="notel-content"><p><a class="link" target="_blank" rel="noopener" href="https://gernot-heiser.org/benchmarking-crimes.html">benchmark crimes <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a><br>è‡ªæ—‹é”çš„scalabilityæå·®ï¼ï¼ˆç±»ä¼¼äºåæ¯”ä¾‹ï¼‰æ“ä½œç³»ç»Ÿåªåœ¨åŠå…¶çŸ­ä¿ƒçš„æ“ä½œä¸Šä½¿ç”¨è‡ªæ—‹é”ã€‚Linux Kernelçš„åˆ†æè§ppté“¾æ¥<br>ä½†Linuxæœ‰å¤§æ¦‚180Kä¸ªéœ€è¦å†…å­˜ä¿æŠ¤çš„å‡½æ•°ï¼Œæ€ä¹ˆåŠï¼Ÿ<br>ä¸€ä¸ªç‰¹æ€§ï¼šç»å¤§å¤šæ•°æ•°æ®ç»“æ„éƒ½æ˜¯Read-mostly<br>å¯ä¸å¯ä»¥è¯»ä¸åŠ é”ï¼ŸRCU(Read-Copy-Update)ç­–ç•¥ï¼<br>ç‰ºç‰²è¯»å†™çš„ä¸€è‡´æ€§ï¼Œé€‰æ‹©write-on-copyï¼Œå†™å…¥çš„æ—¶å€™å¤åˆ¶å»ºä¸€ä»½æ–°çš„ï¼ˆå¯¹äºå¸¸è§æ•°æ®ç»“æ„ï¼Œä¸æ˜¯å‚»å‚»çš„å¤åˆ¶ï¼Œåˆé«˜æ•ˆçš„éƒ¨åˆ†å¤åˆ¶ï¼‰ï¼Œè¿™æ ·<strong>æ€»èƒ½è¯»åˆ°</strong>ä¸€ä¸ªã€‚<br>ç”¨æˆ·ç¨‹åº<strong>åº”è¯¥èƒ½å®¹å¿</strong> <strong>å°‘é‡çš„</strong>è¯»åˆ°é”™çš„ã€‚ï¼ˆæ¯”æ–¹è¯´è·¯ç”±è¡¨ï¼Œè¯»åˆ°é”™çš„å¤§ä¸äº†é‡å‘ä¸€æ¬¡ï¼‰<br>è¿™æ ·å°±è§£å†³äº†æ€§èƒ½é—®é¢˜ã€‚<br>ä»€ä¹ˆæ—¶å€™æ‰”æ‰æ—§ç‰ˆæœ¬ï¼Ÿé˜…è¯»ææ–™ï¼ˆå¹¶æ²¡æœ‰å•Šã€‚ã€‚ã€‚ï¼‰</p>
 </div></div>

<p><strong>XV6 Spinlockæ‹¿æ¥åœ¨å®éªŒé‡Œç”¨å°±è¡Œäº†</strong></p>
<hr>
<p>æ€§èƒ½é—®é¢˜ï¼šå¤§é‡çš„è‡ªæ—‹é”ä¼šæµªè´¹å¤§é‡çš„èµ„æºã€‚<br>æŒæœ‰é”çš„çº¿ç¨‹è¢«ä¸­æ–­ï¼Ÿï¼Ÿï¼Œæ¢ä¸€ä¸ªè‡ªæ—‹çš„ï¼Œè¿™æ ·å¯èƒ½ä¼š100%åœ°å ç”¨èµ„æºã€‚<br>æ€ä¹ˆåŠï¼šåœ¨è‡ªæ—‹çš„æ—¶å€™è°ƒåº¦åˆ°å…¶ä»–çº¿ç¨‹ï¼ˆç”±æ“ä½œç³»ç»Ÿæ¥åšï¼ï¼‰<br>pthread_mutex_lock<br>Futex: å¦‚æœæ— äººäº‰æŠ¢å°±ä¸ä¼šé™·å…¥æ“ä½œç³»ç»Ÿå†…æ ¸ï¼Œå¦‚æœæœ‰äººäº‰æŠ¢å°±ä¼šäº¤ç»™æ“ä½œç³»ç»Ÿè°ƒåº¦ã€‚<br>æœ‰å¾ˆå¤šå¹¶ä¸æ˜¾ç„¶çš„å›°éš¾é—®é¢˜</p>
<p><strong>è‡³å°‘ç›®å‰ï¼Œmutexå°±æ˜¯é»‘ç®±å°±å¯ä»¥äº†</strong></p>
<h2 id="Lecture-8-Snack"><a href="#Lecture-8-Snack" class="headerlink" title="Lecture 8 (Snack)"></a>Lecture 8 (Snack)</h2><div class="note note-primary icon-padding"><i class="note-icon fa-solid fa-circle-arrow-right"></i><p><a class="link" target="_blank" rel="noopener" href="https://jyywiki.cn/OS/2024/lect8.md">åŠ¡å¿…æ­é…jyywikié£Ÿç”¨ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a><br>å¥½ç”¨çš„å·¥å…· <a class="link" target="_blank" rel="noopener" href="https://gcc.godbolt.org/">Compiler Explorer <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
</div>
<p>è®°ä½ä¸¤ä»¶äº‹ï¼š<br>æœªæµ‹ä»£ç éƒ½æ˜¯é”™çš„ï¼<br>æˆ‘å†™çš„éƒ½æ˜¯é”™çš„ï¼</p>
<p>ç¼–è¯‘å™¨ + ç¼–è¯‘é€‰é¡¹ + ç‰¹å®šçš„ç¡¬ä»¶ + luck = BUG</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Requirements ---&gt; Design ---&gt; Code[Fault] ---&gt; Execution[Error] ---&gt; [Failure]</span><br><span class="line">              â†‘           â†‘        â†‘                                     â†‘</span><br><span class="line">mistake here--+-----------+   Where you make                        Where you find</span><br></pre></td></tr></table></figure></div>

<p>è°ƒè¯•å°±æ˜¯è§‚å¯ŸçŠ¶æ€æœºçš„ä¾§é¢ï¼Œä»¥ä¾¿äºæ‰¾åˆ°â€œç¬¬ä¸€ä¸ªé”™è¯¯çš„çŠ¶æ€â€<br>printfå°±æ˜¯çŠ¶æ€çš„æ‘˜è¦ï¼Œä½¿äººèƒ½å¤Ÿé€šè¿‡çŸ¥è¯†è¿›è¡Œåˆ¤æ–­ï¼šå¿«é€Ÿçš„å¯¹æ‰§è¡Œè¿›è¡Œåˆ†å—ï¼Œå®šä½é”™è¯¯åœ¨å“ªä¸€ä¸ªå—ä¸Š<br>ä½†åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œæœ‰å¾ˆå¤šçš„é”™è¯¯çŠ¶æ€åªæ˜¯ä¸€ä¸ªå€¼ï¼Œé•¿å¾—å’Œåˆ«çš„å€¼æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼</p>
<hr>
<p>è°ƒè¯•ä¸€åˆ‡ï¼ˆçŠ¶æ€æœºï¼‰ï¼<br>å¦‚ä½•è§£å†³ä¸€ä¸ªæ–°é—®é¢˜ï¼Ÿ<br>UNIXå“²å­¦ä¸­ï¼Œæ•´ä¸ªä½¿ç”¨è®¡ç®—æœºéƒ½æ˜¯ç¼–ç¨‹ï¼Œä½ éƒ½å¯ä»¥å»è§‚å¯Ÿä¾§é¢ï¼Œæ€ä¹ˆè§‚å¯Ÿï¼Ÿ</p>
<ul>
<li>make program verbose <code>-v</code></li>
<li>Profiler <code>perf</code> and Trace <code>strace</code></li>
</ul>
<blockquote>
<p>ç»è¿‡æŸ¥è¯¢ï¼Œå·¥å…·ä¸­çš„verboseå¥½åƒçœŸçš„æ˜¯é€šè¿‡å¤šçº§çš„ifåˆ™printfç»„ç»‡çš„ã€‚ã€‚ã€‚(GPT)</p>
</blockquote>
<div class="note note-green icon-padding"><i class="note-icon fa-solid fa-bolt"></i><p><strong>æ ¸å¿ƒæ–¹æ³•è®º</strong>ï¼šstrace/verbose çš„ä¸ç†è§£ï¼ŸGPTå¯ä»¥å‘Šè¯‰ä½ ï¼<br>GPTéå¸¸æ“…é•¿è§£é‡Šå……æ»¡äº†é™Œç”Ÿåè¯ä½†æ²¡æœ‰å¤æ‚é€»è¾‘çš„ä¸œè¥¿</p>
</div>

<p>æŠ¥é”™ä¿¡æ¯æœ‰çš„æ—¶å€™ä¸å¯é çš„ï¼Œä½†æ˜¯å®ƒä¸€å®šâ€œåœ¨ä»€ä¹ˆåœ°æ–¹æ‰“å°å‡ºæ¥â€ã€‚<br>åˆå­¦è€…ï¼ˆåˆ«äººé‡åˆ°è¿‡è¿™ä¸ªé—®é¢˜ï¼‰â€”&gt; èµ„æ·±ç¨‹åºå‘˜ï¼ˆå‘ç°åŸå› å¹¶è§£å†³é—®é¢˜ï¼‰ï¼ˆâ€œæ‰¾å¯¹è±¡ä¸€å®šç»™è¦æ‰¾ç¨‹åºå‘˜ï¼šå› ä¸ºå‡ºäº†é—®é¢˜éƒ½æ˜¯è‡ªå·±çš„åŸå› â€ï¼‰</p>
<div class="note note-primary icon-padding"><i class="note-icon fa-solid fa-circle-arrow-right"></i><p><strong>é‡æ–°å‘ç°GDB</strong>ï¼š <a href="">GDBæ–‡æ¡£</a> <a href="">QuickGuide</a><br>ä¸€äº›æ¢¦å¯ä»¥æ±‚çš„åŠŸèƒ½å…¶å®GDBå·²ç»å®ç°äº†ï¼š æ¯”æ–¹è¯´é€†å‘æ‰§è¡Œï¼ï¼ˆè¿˜æœ‰å’Œå¹¶å‘ç›¸å…³çš„ï¼‰</p>
</div>

<div class="note-large notel-orange"><div class="notel-title"><p>Extention</p>
</div><div class="notel-content"><p>GDB Cheat Sheet.<br>I have been on it for sometime, though pigeoning!<br><a class="link" target="_blank" rel="noopener" href="https://github.com/Jackcuii/Commandline-quick-sheet">Commandline-quick-sheet <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
 </div></div>

<div class="note-large notel-red"><div class="notel-title"><p>Spicy: Really Spicy!</p>
</div><div class="notel-content"><p>æ—¶é—´å‹åŠ›ä¸‹ï¼Œæˆ‘ä»¬ä¼šè¢«è¿«ç”¨è‚Œè‚‰è®°å¿†è§£å†³é—®é¢˜<br>â€”&gt; åœæ­¢è‡ªå·±çš„æŠ€æœ¯æ¼”è¿›<br>â€”&gt; æœ€åæŠ€æœ¯ä¸ç¤¾åŒºè„±èŠ‚ï¼Œæˆä¸ºæ²¹è…»çš„ä¸­å¹´â€œé”®ç›˜ä¾ â€<br>æ€ä¹ˆåŠï¼Ÿ<br><img lazyload="" src="/images/loading.svg" data-src="https://s2.loli.net/2024/03/25/1hi9KtFRMXcGTrC.png" width="300"></p>
 </div></div>

<p>åº”ç”¨è°ƒè¯•ç†è®ºï¼šä»€ä¹ˆæ˜¯å¥½çš„ä»£ç ï¼Ÿ<br>Self-Explanatory Code: ä»£ç åº”è¯¥æ˜¯è‡ªè§£é‡Šçš„ï¼Œä¸éœ€è¦é¢å¤–çš„æ³¨é‡Š<br>Self-evident Code: ä»£ç åº”è¯¥æ˜¯è‡ªè¯æ˜çš„ï¼Œå¯ä»¥é€šè¿‡é˜…è¯»ç¡®è®¤å’Œéœ€æ±‚çš„ä¸€è‡´æ€§ã€‚</p>
<div class="note note-green icon-padding"><i class="note-icon fa-solid fa-bolt"></i><p><strong>æ ¸å¿ƒæ–¹æ³•è®º</strong>ï¼šå› ä¸ºAIè¿˜â€œä¸å¤Ÿèªæ˜â€ï¼šAI is a benchmark! å¦‚æœä½ çš„ä»£ç AIèƒ½å¤Ÿç†è§£ï¼Œé‚£ä¹ˆè¯´æ˜æ˜¯å¥½ä»£ç ã€‚</p>
</div>

<hr>
<p>å†™å‡ºBUGäº†æ€ä¹ˆåŠï¼Ÿ</p>
<ul>
<li>å¤šæµ‹è¯•</li>
<li>ç¼©çŸ­Errorå’ŒFailureï¼šæ–­è¨€</li>
</ul>
<blockquote>
<p>ç¼–è¯‘é€‰é¡¹ï¼š<code>-fsanitize=address</code> è‡ªåŠ¨æ·»åŠ æ–­è¨€æ£€æŸ¥å­˜å‚¨é”™ã€‚</p>
</blockquote>
<h2 id="Lecture-9-C"><a href="#Lecture-9-C" class="headerlink" title="Lecture 9 (C)"></a>Lecture 9 (C)</h2><p>å®è§‚ç†è§£é”<br>åº”ç”¨ç¨‹åºä¹Ÿä¼šè¢«ä¸­æ–­ï¼Œä¸ºä»€ä¹ˆä¸éœ€è¦ä¸Šé”ï¼Ÿå› ä¸ºä¸­æ–­å¯¹ç”¨æˆ·ç¨‹åºæ˜¯ä¸å¯è§çš„ï¼Œä¸­æ–­ç¨‹åº(å†…æ ¸æ€)ä¸å›å»è¯•å›¾è·å–ç”¨æˆ·æ€çš„ğŸ”’ã€‚</p>
<p>çŠ¶æ€æœºè§†è§’çš„åŒæ­¥ï¼Œç®€å•çš„çŠ¶æ€å˜å¤æ‚ï¼Œå†è®©ä¸–ç•Œæ”¶æŸåˆ°ç®€å•çš„çŠ¶æ€<br>â€ç›¸äº’å·²çŸ¥çš„ç®€å•çŠ¶æ€â€œ<br><em>â€œç”µå­ä¹åé©±jyyâ€</em></p>
<p>æ¶ˆè´¹è€…ç”Ÿäº§è€…é—®é¢˜ï¼Œå¯ä»¥è§£å†³99%çš„åŒæ­¥é—®é¢˜ï¼<br>æ¦‚å¿µæ¨¡å‹ï¼šå¾€æœ‰é™ç¼“å†²åŒºæ”¾ä¸œè¥¿/å–ä¸œè¥¿</p>
<div class="note note-cyan icon-padding"><i class="note-icon fa-solid fa-user-secret"></i><p><a class="link" target="_blank" rel="noopener" href="https://github.com/Jackcuii/jyy-codes-test-and-read/blob/master/pc-1.c">ç¬¬ä¸€ä¸ªé”™è¯¯çš„ç”Ÿäº§è€…-æ¶ˆè´¹è€…å®ç° <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
</div>
<div class="note note-cyan icon-padding"><i class="note-icon fa-solid fa-user-secret"></i><p><a class="link" target="_blank" rel="noopener" href="https://github.com/Jackcuii/jyy-codes-test-and-read/blob/master/pc-2.c">ç¬¬ä¸€ä¸ªæ­£ç¡®çš„ç”Ÿäº§è€…-æ¶ˆè´¹è€…å®ç° <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a><br>è™½ç„¶å®ƒæ€»æ˜¯åœ¨â€œè‡ªæ—‹â€åœ¨æµªè´¹cpuèµ„æºï¼</p>
</div>
<p>ä½†è¿™æ˜¯ä¸€ä¸ªä¸‡èƒ½çš„æ–¹æ³•ï¼Œä¸Šé¢çš„depthåˆ¤æ–­å¯ä»¥æŠ½è±¡æˆCAN_PRODUCE/CAN_CONSUME<br>è¿™æ ·å°±æ˜¯ä¸€ä¸ªä¸‡èƒ½çš„æ¨¡æ¿äº†ï¼</p>
<div class="note note-green icon-padding"><i class="note-icon fa-solid fa-bolt"></i><p><strong>æ ¸å¿ƒæ–¹æ³•è®º</strong>ï¼šä¸ºä»€ä¹ˆâ€œæ‰“å°æ‹¬å·â€ï¼Ÿè·å¾—ä¸€ä¸ªå®¹æ˜“å†™ç¨‹åºè¿›ä¸€æ­¥æ£€æŸ¥ï¼Œç›´è§‚çš„æŒ‡æ ‡ï¼æŠŠé—®é¢˜å…·è±¡åŒ–ï¼</p>
</div>
<p>æœ‰ä¸€ä¸ªé€šç”¨çš„æ¨¡å‹ï¼Œä¸€å®šæœ‰å¯¹åº”çš„æ¥å£å®ç°ã€‚<br>æˆ‘ä»¬å‘æ˜äº†æ¡ä»¶å˜é‡ï¼Œä½†è¿˜ä¸è¦è¿™ä¹ˆå‚»ï¼ˆä¼‘çœ ï¼Œç­‰å¾…å”¤é†’ï¼‰ï¼šå½“ç„¶æœ‰ç°æˆçš„åº“ï¼</p>
<div class="note note-cyan icon-padding"><i class="note-icon fa-solid fa-user-secret"></i><p><a class="link" target="_blank" rel="noopener" href="https://github.com/Jackcuii/jyy-codes-test-and-read/blob/master/pc-cv.c">ä½¿ç”¨äº†æ¡ä»¶å˜é‡çš„æ¥å£ï¼å¾ˆå¯æƒœï¼Œè¿˜æ˜¯é”™çš„ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ä¹¦ä¸Šè§£é‡Šäº†ğŸ›</p>
</div>
<div class="note note-cyan icon-padding"><i class="note-icon fa-solid fa-user-secret"></i><p><a class="link" target="_blank" rel="noopener" href="https://github.com/Jackcuii/jyy-codes-test-and-read/blob/master/pc-cv-broadcast.c">çœŸæ­£å…¨å±€æ­£ç¡®çš„å®ç°ï¼Œæ­£ç¡®æ‰“å¼€æ–¹å¼ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
</div>

<p><strong>ä¸€ä¸ªé”å®ç°çœŸæ­£æ­£ç¡®çš„æ¡ä»¶å˜é‡</strong></p>
<ol>
<li>å”¤é†’åå†æ£€æŸ¥</li>
<li>å”¤é†’æ‰€æœ‰æ½œåœ¨è¢«å”¤é†’çš„äºº</li>
</ol>
<p><strong>æˆ‘ä»¬æœ€å¥½è¿™æ ·å†™â†‘</strong></p>
<p>ä¸ºä»€ä¹ˆå¯ä»¥è§£å†³99%çš„é—®é¢˜ï¼Ÿ<br>è®¡ç®—ä»»åŠ¡éƒ½æ˜¯æœ‰å‘æ— ç¯å›¾ï¼Œè®¡ç®—å›¾åˆ‡åˆ†ï¼ˆæœ‰åºæ€è€ƒæ–¹å¼ï¼‰</p>
<ol>
<li>ä¸€ä¸ªç”Ÿäº§è€…ï¼Œæ¯ä¸ªæ ¸å¿ƒæ˜¯æ¶ˆè´¹è€…ï¼Œç”Ÿäº§è€…ï¼ˆè°ƒåº¦å™¨ï¼‰æ‹“æ‰‘æ’åºè®¡ç®—å›¾ï¼ŒæŠŠä»»åŠ¡åˆ†é…ç»™æ¶ˆè´¹è€…å³å¯ã€‚ï¼ˆçº¿ç¨‹æ± çš„å·¥ä½œåŸç†ï¼‰</li>
<li>è¿˜å¯ä»¥æ¯ä¸ªç»“ç‚¹éƒ½è®¾ç½®ä¸€ä¸ªæ¡ä»¶å˜é‡ã€‚åŒæ­¥æ¡ä»¶å°±æ˜¯ä¾èµ–çš„éƒ½å®Œæˆäº†</li>
</ol>
<p>1%<br>å¦‚æœé‡åˆ°äº†å†™ä¸å‡ºçš„æ¡ä»¶çš„æ€ä¹ˆåŠï¼Ÿå¯ä»¥å€ŸåŠ©çŠ¶æ€æœºè¿›è¡ŒçŠ¶æ€è½¬æ¢ã€‚<br>å†™å‡ºäº†çŠ¶æ€æœºï¼Œè¿˜æ˜¯å¯ä»¥ç”¨æ¡ä»¶å˜é‡è§£å†³ã€‚</p>
<div class="note-large notel-primary"><div class="notel-title"><p>icon-padding</p>
</div><div class="notel-content"><p>è¿™ä¸ªè¦çœ‹jyyçš„ç¬¬ä¹èŠ‚çš„è§†é¢‘ï¼ˆğŸŸçš„å®ç°ï¼‰</p>
 </div></div>


<h2 id="Lecture-10-C"><a href="#Lecture-10-C" class="headerlink" title="Lecture 10 (C)"></a>Lecture 10 (C)</h2><p>æˆ‘ä»¬å¯ä»¥ç”¨äº’æ–¥é”æ¥æ§åˆ¶åŒæ­¥<br>è‡ªæ—‹é”å’Œäº’æ–¥é”ï¼Ÿ<br>pthreadè¦æ±‚å¿…é¡»æ˜¯åŒä¸€ä¸ªçº¿ç¨‹requireå’Œrelease</p>
<p>é€‚ç”¨äºä¸€èˆ¬æ¨¡å‹ï¼šç»™æ¯æ¡è¾¹åˆ†åˆ«åŠ é”ï¼å°±åƒæ˜¯ä¸€ä¸ªæ‹“æ‰‘æ’åºï¼ç»™å…¥è¾¹ä¸Šé”ï¼Œç»™å‡ºè¾¹è§£é”ï¼</p>
<p>ç†è§£ä¿¡å·é‡ï¼šå£è¢‹å’Œçƒ<br>ä¿¡å·é‡å¯ä»¥ç†è§£æˆæ˜¯äº’æ–¥é”çš„è‡ªç„¶æ‰©å±•ï¼Œä¸è¿‡å…è®¸ä¸åŒçš„äººå»æ”¾çƒï¼ˆé‡Šæ”¾é”ï¼‰å’Œæ‹¿çƒï¼ˆè·å–é”ï¼‰<br>æ‰€ä»¥å°±å¯ä»¥ç”¨ä¿¡å·é‡å»å®ç°ä¸Šé¢çš„æ¨¡å‹ï¼</p>
<p>ä¿¡å·é‡è¿˜å¯ä»¥ç”¨æ¥ç®¡ç†è®¡æ•°å‹èµ„æº</p>
<p>ä¿¡å·é‡æ¥å®ç°ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜ï¼Ÿä¸ºä»€ä¹ˆéè¦æœ‰ä¸¤ä¸ªè¢‹å­ï¼Ÿ</p>
<p>ä¿¡å·é‡ä¸å¤ªå¥½å®ç°é€‰æ‹©çš„é—®é¢˜ï¼ŒäºŒé€‰ä¸€çš„æƒ…å†µä¸‹å¿…é¡»è¦ä½ æ¥å†³å®šçƒæ‰”ç»™è°ï¼Œä½†ä¹Ÿå› æ­¤æ›´é«˜æ•ˆï¼ˆä¸ä¼šå”¤é†’æ‰€æœ‰åç»§èŠ‚ç‚¹ï¼‰</p>
<hr>
<p>å¯¹æ¯”ï¼š<br><strong>å“²å­¦å®¶åƒé¥­é—®é¢˜</strong><br>ç”¨ä¿¡å·é‡å¾ˆéš¾å®ç°ï¼šæ‰€æœ‰äººéƒ½ä¼šæ‹¿èµ·å·¦è¾¹çš„ç­·å­ï¼Œç„¶åç­‰å¾…å³è¾¹çš„ç­·å­ï¼Œæœ€åæ­»é”<br>ç”¨æ¡ä»¶å˜é‡ï¼šæ— è„‘å®ç°ï¼Œå› ä¸ºäº’æ–¥é”ä¿è¯äº†ä¸€ä¸‹æ‹¿ä¸¤ä¸ªç­·å­ã€‚</p>
<p>æ€ä¹ˆç”¨ä¿¡å·é‡è§£å†³ï¼Ÿæœ‰ä¸€äº›æ–¹æ¡ˆ</p>
<ol>
<li>ä»æ¡Œå­ä¸Šèµ¶èµ°ä¸€ä¸ªäººï¼Œæ€»æœ‰ä¸€ä¸ªäººèƒ½æ‹¿åˆ°ã€‚</li>
<li>ç»™å‰å­ç¼–å·ï¼Œæ€»æ‹¿å¤§çš„ã€å°çš„</li>
</ol>
<p>ä½†è¿™æ˜¯ä¸€ç§trickï¼Œå¹¶ä¸scalableã€‚<br>â€”â€”â€”â€”å› ä¸ºå½“é—®é¢˜å˜å¤æ‚æ—¶ï¼Œä½ éƒ½è¦å»è€ƒè™‘è¿™ä¸ªé—®é¢˜ï¼Œè€Œä¸”è¿˜ä¸ä¸€å®šèƒ½è§£å†³ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œæ¡ä»¶å˜é‡æ›´åŠ ç®€å•, æ›´æ™®é€‚ã€‚<br>å¯¹äºç°å®ä¸–ç•Œï¼Œæ›´å¤šçš„å¹¶å‘é—®é¢˜éƒ½æ˜¯çº¿ç¨‹æ•°è§„æ¨¡è¿œå°äºå•çº¿ç¨‹ä»»åŠ¡é‡ï¼Œæ¡ä»¶å˜é‡çš„å¼€é”€å°±æ˜¾å¾—ä¸å€¼ä¸€æã€‚</p>
<h2 id="Lecture-11-Snack"><a href="#Lecture-11-Snack" class="headerlink" title="Lecture 11 (Snack)"></a>Lecture 11 (Snack)</h2><p>Webå†å²ï¼Œè¯¦è§ppt<br>Webå¸¦æ¥çš„å¹¶å‘é—®é¢˜ï¼šè¯·æ±‚å’Œæ›´æ–°ä¸åŒçš„èµ„æºï¼Œæˆ‘ä»¬å¸Œæœ›ä»–ä»¬å¹¶å‘ã€‚<br>Solution: ç¦æ­¢å¹¶å‘ï¼ŒEvent-based concurrencyï¼Œå…è®¸å¼‚æ­¥æ“ä½œ+å›è°ƒå‡½æ•°ï¼Œå®é™…ä¸Šæ²¡æœ‰ä»»ä½•å¹¶å‘ã€‚<br>åŠ¨æ€è®¡ç®—å›¾ï¼šPromiseï¼šç›´æ¥æè¿°åŠ¨æ€è®¡ç®—å›¾ã€‚</p>
<p>å…³äºé«˜æ€§èƒ½è®¡ç®—çš„éƒ¨åˆ†ç¡®å®æ˜¯éœ€è¦å…³æ³¨çš„ï¼Œæ¯•ç«Ÿå’Œæœ¬è¡ŒArchå¯†åˆ‡ç›¸å…³</p>
<p>è¿™èŠ‚è¯¾å…¶å®å¾ˆéš¾ç»™å‡ºä¸€ä¸ªæ˜ç¡®çš„æ€»ç»“ï¼Œä½†ä¸€ä¸ªtake-away messageå¯ä»¥è¯´æ˜¯é»„èƒ–å­çš„è¯ã€‚</p>
<h2 id="Lecture-12-C"><a href="#Lecture-12-C" class="headerlink" title="Lecture 12 (C)"></a>Lecture 12 (C)</h2><p><strong>æ­»é”</strong></p>
<ul>
<li>AA-Deadlock: wait for self.</li>
<li>ABBA-Deadlock: wait for each other.</li>
</ul>
<p>L1ä¼šé‡åˆ°ï¼</p>
<p><a class="link" target="_blank" rel="noopener" href="https://dl.acm.org/doi/10.1145/356586.356588">å…³äºDeadlockçš„è®ºæ–‡ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>ğŸ›<br>æ­»é”äº§ç”Ÿçš„å¿…è¦æ¡ä»¶<br>å¯ä»¥æ¯æ¬¡ç­‰å¾…çš„æ—¶å€™çš„è¾“å‡ºä¸€ä¸‹ç­‰å¾…å…³ç³»ä»è€Œå‘ç°æ­»é”ã€‚</p>
<p><strong>é¿å…æ­»é”</strong></p>
<ul>
<li>Lock Ordering: ç»™æ‰€æœ‰é”ç¼–å·ï¼Œä¸¥æ ¼æŒ‰ç…§ç¼–å·é¡ºåºåŠ é”,â€æŒæœ‰æœ€å¤§çš„ç¼–å·çš„é”çš„çº¿ç¨‹æ€»èƒ½ç»§ç»­è¿è¡Œï¼â€</li>
</ul>
<p><strong>Data Race</strong><br>Read-Write/Write-Write</p>
<ul>
<li>å¯¹äºGreen Handï¼Œä¸¥æ ¼é¿å…æ•°æ®ç«äº‰ï¼</li>
</ul>
<p>L2ï¼šæ›´åŠ éšå½¢çš„æ•°æ®ç«äº‰</p>
<p>æ— éå°±æ˜¯<strong>ä¸Šé”™äº†ğŸ”’</strong>å’Œ<strong>å¿˜äº†ä¸ŠğŸ”’</strong><br><strong>ä¸¤æ¡åŸåˆ™</strong>ï¼šç”¨ğŸ”’ä¿æŠ¤æ•°æ®ï¼Œä¸¥æ ¼é¿å…æ•°æ®ç«äº‰</p>
<p><strong>æœ¬è´¨å›°éš¾</strong>ï¼šâ€œåäººæ€§(sequential)â€ å’Œ â€œåæœè‡ªè´Ÿ(No compile error!)â€</p>
<p>Atomicity Violationï¼ˆABAï¼‰<br>Order Violationï¼ˆBAï¼‰ï¼šuse-after-freeâ€¦ æœ€åé‚£é‡Œï¼Ÿ</p>
<h2 id="Lecture-13-C"><a href="#Lecture-13-C" class="headerlink" title="Lecture 13 (C)"></a>Lecture 13 (C)</h2><h2 id="Lecture-14-V"><a href="#Lecture-14-V" class="headerlink" title="Lecture 14 (V)"></a>Lecture 14 (V)</h2><div class="note note-primary icon-padding"><i class="note-icon fa-solid fa-circle-arrow-right"></i><p><a class="link" target="_blank" rel="noopener" href="https://jyywiki.cn/OS/2024/lect14.md">åŠ¡å¿…æ­é…jyywikié£Ÿç”¨ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
</div>
<p>æ§åˆ¶ç³»ç»Ÿçš„åŠ è½½</p>
<div class="note note-cyan icon-padding"><i class="note-icon fa-solid fa-user-secret"></i><p>é˜…è¯»minimalåŠ è½½çš„makefileğŸ›</p>
</div>
<ul>
<li><p>fork å¤åˆ¶ä¸€ä»½çŠ¶æ€æœºï¼ˆä¸ºä»€ä¹ˆåªèƒ½å¤åˆ¶ï¼Ÿ<br>åŒºåˆ†ï¼šè¿”å›å€¼ä¸åŒ<br>fork bombï¼<br>USE mosaic<br>fork_demoä¸ºä»€ä¹ˆæ˜¯48ç§ï¼Ÿï¼Ÿï¼Ÿ</p>
<ul>
<li>è¯¡å¼‚çš„â€œ8ä¸ªhelloâ€<br>ä½ æ²¡æœ‰æ­£ç¡®ç†è§£printf!<br>bufä¹Ÿè¢«å¤åˆ¶äº†ï¼<br>unbuffer, line buffer, fully bufferâ€¦<br>ï¼ˆè°¨æ…çš„ä½¿ç”¨ä»»ä½•éšå«å‡è®¾ï¼ï¼‰</li>
<li>fork æ—¶å€™é»˜è®¤ç»§æ‰¿äº†ç¯å¢ƒå˜é‡</li>
</ul>
</li>
<li><p>execve<br>æŠ›å¼ƒç°æœ‰çš„æ‰€æœ‰çŠ¶æ€ï¼Œå‡†å¤‡å¥½å‚æ•°ï¼Œè®¾ç½®ä¸ºå¦ä¸€ä¸ªçŠ¶æ€æœºçš„åˆå§‹çŠ¶æ€<br>è¿›ç¨‹æ€»æ˜¯ä»è¿™ä¸ªå¼€å§‹</p>
<ul>
<li>PATH ç¯å¢ƒå˜é‡ï¼šexecveçš„æŸ¥æ‰¾é¡ºåº</li>
</ul>
</li>
<li><p>_exit<br>atexit (normal process exit æ—¶è°ƒç”¨å›è°ƒå‡½æ•°, æ³¨æ„ï¼Œè¿™æ˜¯<strong>Cçš„æœºåˆ¶</strong>)</p>
<ul>
<li>return é0</li>
<li>exit(x) éƒ½æ˜¯Normal exit</li>
</ul>
<p>ä¸Šé¢éƒ½æ˜¯è°ƒç”¨libcâ€“Cè¯­è¨€åº“çš„é€€å‡ºï¼Œéƒ½æ˜¯å¯¹Cå¯è§çš„ï¼Œæ‰€ä»¥éƒ½æ˜¯Normal exit</p>
<ul>
<li>_exit(0) åˆ©ç”¨ç³»ç»Ÿè°ƒç”¨ç›´æ¥é€€å‡ºæ‰§è¡Œçš„æ˜¯exit_group</li>
<li>__exit(0) æ˜¯æ‰§è¡Œexit</li>
</ul>
<p>ä¸Šé¢éƒ½æ˜¯éæ­£å¸¸é€€å‡º<br>è°ƒæŸ¥è¿™äº›é—®é¢˜ï¼Œåˆ«å¿˜äº†Straceâ€¦</p>
</li>
</ul>
<p>â€œæ“ä½œç³»ç»Ÿæ˜¯çŠ¶æ€æœºçš„ç®¡ç†è€…ï¼Œå®ƒæŠŠæ‰€æœ‰çŠ¶æ€æœºéƒ½å‰ªç¢å­˜åœ¨æ•°æ®ç»“æ„é‡Œï¼Œå½“æƒ³è¦æ‰§è¡Œçš„æ—¶å€™å†æ‹¼æ¥èµ·æ¥ï¼ŒåŠ è½½åˆ°CPUä¸Šã€‚â€</p>
<h2 id="Lecture-15-V"><a href="#Lecture-15-V" class="headerlink" title="Lecture 15 (V)"></a>Lecture 15 (V)</h2><p>28minå·¦å³<br>/proc/maps<br>pmap<br>gdb<br>åœ°å€ç©ºé—´æ˜¯æœ‰è¯»å†™æƒé™çš„å†…å­˜æ®µ</p>
<p>å…¥ä¾µè¿›ç¨‹çš„åœ°å€ç©ºé—´ï¼ï¼šgdb<br>å¤–æŒ‚ï¼</p>
<ul>
<li>æœ€æ—©æœŸçš„æ¸¸æˆå¤–æŒ‚ï¼Œä¸€ä¸ªç‰©ç†çš„æŸ¥æ‰¾è¡¨ï¼Game Genie</li>
<li>åŠ«æŒçº¢è­¦çš„åœ°å€ç©ºé—´ï¼šFilter</li>
<li>gdbå°±æ˜¯ä¸€ä¸ªå·¨å¤§çš„å¤–æŒ‚ï¼<ul>
<li>è®¿é—®proc/mem procfsæä¾›ç»™æˆ‘ä»¬çš„ä¸€ä¸ªæ–‡ä»¶ï¼Œç›´æ¥æŒ‡å‘æ•´ä¸ªåœ°å€ç©ºé—´ï¼Œå¯ä»¥ç”¨æ–‡ä»¶æ“ä½œæ¥ä¿®æ”¹åœ°å€ç©ºé—´</li>
<li>æˆ–è€…è¯´å¤–æŒ‚æ˜¯ä¸€ç§æ¸¸æˆçš„è°ƒè¯•å™¨ï¼</li>
</ul>
</li>
</ul>
<p>ydotool</p>
<p>æŒ‰é”®ç²¾çµ</p>
<h2 id="Lecture-16-V"><a href="#Lecture-16-V" class="headerlink" title="Lecture 16 (V)"></a>Lecture 16 (V)</h2><p>æ“ä½œç³»ç»Ÿå¯¹è±¡ï¼š<br>ç¬¬ä¸€ç§ç†è§£ï¼šæ–‡ä»¶ï¼ˆæœ‰åå­—çš„å¯¹è±¡ï¼‰  Everything(what thing? æ“ä½œç³»ç»Ÿå¯¹è±¡) is a file.<br>ç¬¬äºŒç§ç†è§£ï¼šå­—èŠ‚æµï¼ˆç»ˆç«¯ï¼Œå¤–è®¾ï¼‰å’Œå­—èŠ‚åºåˆ—ï¼ˆæ™®é€šæ–‡ä»¶ï¼‰<br>è®¿é—®å¯¹è±¡éœ€è¦<del>æ‰¾å¯¹è±¡</del>æŒ‡é’ˆï¼šç¨‹åºä¸­çš„æŒ‡é’ˆæŒ‡å‘å¯¹è±¡ï¼Œä½†æ°¸è¿œä¸å¯èƒ½æŒ‡å‘â€œæ“ä½œç³»ç»Ÿå¯¹è±¡â€ã€‚<br>å¦‚ä½•æŒ‡å‘â€œæ“ä½œç³»ç»Ÿå¯¹è±¡â€ï¼Œç³»ç»Ÿè°ƒç”¨ï¼ï¼ˆMatrixä¸­çš„äººä¸ä¼šçœ‹åˆ°å¤–é¢çš„ç½å­ï¼ç³»ç»Ÿè°ƒç”¨å°±æ˜¯è“è¯ä¸¸ï¼ï¼‰<br>æ–‡ä»¶æè¿°ç¬¦ï¼ˆä¼šè€ƒï¼‰ï¼šæŒ‡å‘æ“ä½œç³»ç»Ÿå¯¹è±¡çš„æŒ‡é’ˆ</p>
<p>Winâ€™s File Descriptorï¼šhandle å¥æŸ„ï¼ˆå†å²é—®é¢˜ï¼‰</p>
<hr>
<p>å¦ä¸€ç§å¯¹è±¡ IPC Endpoints<br>ç®¡é“ï¼ˆä¸€ç§ç‰¹æ®Šçš„æµï¼‰ï¼špipeå°±æ˜¯buffer è¯»å£å’Œå†™å£å…±äº«<br>ä¸¤ç«¯ä¸€èˆ¬æ˜¯ç”¨ä¸¤ä¸ªæ–‡ä»¶æè¿°ç¬¦æŒ‡å‘ï¼ˆä½†æ–‡ä»¶åªæœ‰ä¸€ä¸ªï¼ï¼‰<br>å¹¶ä¸æ˜¯ä¸¥æ ¼çš„bufferï¼Œ<br>å¦‚æœæ²¡æ•°æ®ï¼Œè¯»ä¸ä¼šè¿”å›<br>å¦‚æœæ²¡äººæ‹¿ï¼Œå†™ä¸ä¼šè¿”å›</p>
<p>å®ç°äº†<strong>I</strong>nter<strong>P</strong>roc<strong>C</strong>ommunication<br>æ˜¯ä¸€ç§è¿›ç¨‹é—´åŒæ­¥æœºåˆ¶ï¼Œå¯ä»¥å®ç°æˆå¼‚æ­¥çš„<br>å‘½åç®¡é“ï¼š<br>ç”¨mkfifo()åˆ›å»ºï¼Œæœ‰å¯¹åº”çš„æ–‡ä»¶å</p>
<blockquote>
<p>We also have UNIX domain sockets for local inter-process communicationâ€“they also have a name in the file system like â€œ/var/run/docker.sockâ€. This is similar to a named pipe.</p>
</blockquote>
<p>åŒ¿åç®¡é“ï¼š<br>ç”¨pipe()åˆ›å»º<br>è‡ªå·±åŒæ—¶æŒæœ‰ä¸¤ä¸ªå£ï¼Œæœ‰ç”¨å—<br>åœ¨forkæ—¶ï¼Œduplicateä¸€ä»½ç®¡é“ä¸ä¼šè¢«å¤åˆ¶ï¼Œå› ä¸ºç®¡é“ä¸åœ¨åœ°å€ç©ºé—´é‡Œï¼Œåªæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œæ‰€ä»¥æ˜¯æµ…æ‹·è´ã€‚<br>ä¹‹åï¼Œå…³æ‰ä¸€ä¸ªå£ï¼Œå°±å»ºç«‹äº†ä¸€ä¸ªçˆ¶å­è¿›ç¨‹ä¹‹é—´çš„ç®¡é“</p>
<p>æ“ä½œç³»ç»Ÿï¼šå¯¹è±¡+API</p>
<p>Shell â€œKernelçš„å£³â€</p>
<p>Kernel-Shell-I/O-Human</p>
<p>Shellæ˜¯æŠŠç”¨æˆ·æŒ‡ä»¤ç¿»è¯‘æˆç³»ç»Ÿè°ƒç”¨çš„è¯­è¨€</p>
<p>man sh</p>
<p>ä¸ºä»€ä¹ˆäººå·¥æ™ºèƒ½æˆ‘ä»¬è¿˜è¦è¯»æ‰‹å†Œ</p>
<p>å› ä¸ºäººå·¥æ™ºèƒ½åªä¼šå‘Šè¯‰ä½ æœ€å¸¸ç”¨çš„è§£æ³•</p>
<p>GPT Archive ä¹Ÿå¼•å…¥è¿™ç§è¡¥å……åŠŸèƒ½</p>
<p>make å±•å¼€</p>
<p>å®ç°ä¸€ä¸ªshell</p>
<p>runcmdé‚£å—</p>
<p>æŠ€å·§gdb skip function</p>
<p>çœ‹ä¸€ä¸‹è°ƒè¯•éƒ¨åˆ†ï¼Œä»¥åŠæœ€åçš„è§£é‡Šï¼Ÿ</p>
<h2 id="Lecture-17-V"><a href="#Lecture-17-V" class="headerlink" title="Lecture 17 (V)"></a>Lecture 17 (V)</h2><div class="note note-primary icon-padding"><i class="note-icon fa-solid fa-circle-arrow-right"></i><p><a class="link" target="_blank" rel="noopener" href="https://jyywiki.cn/OS/2024/lect17.md">åŠ¡å¿…æ­é…jyywikié£Ÿç”¨ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
</div>

<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">             applications: steam.exe</span><br><span class="line">ä»»ä½•ç¨‹åº -â†’ -------------|--------------  </span><br><span class="line">          sys utilities: shell,gcc,ls...       </span><br><span class="line">----------------|-----------------</span><br><span class="line">          libcç­‰Cè¯­è¨€åº“</span><br><span class="line">----------------|-----------------</span><br><span class="line">      OS: å¯¹è±¡+API(syscall)</span><br></pre></td></tr></table></figure></div>
<p>pipeçš„è¡¥å……(è§pptï¼Œé˜…è¯»æ‰‹å†ŒğŸ›)</p>
<div class="note note-green icon-padding"><i class="note-icon fa-solid fa-bolt"></i><p><strong>æ ¸å¿ƒæ–¹æ³•è®º</strong>ï¼šæ·±å…¥é˜…è¯»æ‰‹å†Œçš„æ–¹å¼ï¼šå°è¯•å¤ç°æ‰‹å†Œä¸­æåˆ°çš„è¡Œä¸ºï¼</p>
</div>
<p>â€œCè¯­è¨€æ˜¯æœ€é€šç”¨çš„é«˜çº§è¯­è¨€ï¼ŒCè¯­è¨€æ˜¯ä¸€ç§é«˜çº§çš„æ±‡ç¼–è¯­è¨€â€<br>â€œæœ€è–„çš„æŠ½è±¡â€<br>çœ‹ä¸€çœ‹ C23ï¼ğŸ›</p>
<p>libc å¯ä»¥ç”¨å¤šåŠCè¯­è¨€æœ¬èº«å’Œä¸€äº›åº•å±‚æ”¯æŒå®ç°ã€‚<br>å·²ç»è¢«æ ‡å‡†åŒ– ISO IEC<br>POSIX libcçš„å­é›†ï¼š æœ€å¤§çš„ä½“ç³»ç»“æ„å¯ç§»æ¤æ€§ï¼</p>
<p>glibcæä¾›äº†_start!</p>
<div class="note note-green icon-padding"><i class="note-icon fa-solid fa-bolt"></i><p><strong>æ ¸å¿ƒæ–¹æ³•è®º</strong>ï¼šå­¦ä¹ glibcï¼Œä½¿ç”¨ç®€åŒ–ç‰ˆçš„glibcï¼Œæ¯”å¦‚musl libc ğŸ›<br>æˆ‘æ€ä¹ˆçŸ¥é“ï¼Ÿå¯ä»¥å»é—®é—®GPTçš„æ•™å­¦æ„è§ï¼ˆç»·ï¼Œä¸Šé¢çš„ååŠè¡Œç”šè‡³æ˜¯copilotè¡¥å……å‡ºæ¥çš„ï¼‰</p>
</div>
<p>æ§åˆ¶gccé“¾æ¥å“ªäº›ä¸œè¥¿ï¼Œä¸é“¾æ¥é‚£äº›ä¸œè¥¿ï¼Œæ¯”æ–¹è¯´é“¾æ¥è‡ªå·±çš„glibcï¼šå¯ä»¥å‚è€ƒmusl-gccçš„æœºåˆ¶ï¼ï¼ˆGPTå¯ä»¥å†™è¿™ç§ä¸œè¥¿ï¼‰</p>
<p>execve ä¹‹ååšäº†ä»€ä¹ˆï¼šæˆ‘ä»¬æ¥è°ƒè¯•ï¼<br>ç»†è‡´çš„å»çœ‹ç¨‹åºçš„ä¸€ç”Ÿï¼šåŠ è½½ï¼Œargc,argv,envpå“ªé‡Œæ¥ï¼Œlibcæ€ä¹ˆæ§åˆ¶è¿›å…¥ä½ çš„ç¨‹åºï¼Œä¹ƒè‡³libcå¦‚ä½•é€€å‡ºä½ çš„ç¨‹åºâ€¦</p>
<div class="note note-green icon-padding"><i class="note-icon fa-solid fa-bolt"></i><p>å¾ªåºæ¸è¿›ï¼šminimal.img -&gt; freestanding shell -&gt; musl libc -&gt; glibcâ€¦</p>
</div>

<hr>
<p>ä½“ç³»ç»“æ„æ— å…³çš„æŠ½è±¡ï¼špptä¸Šçš„ä¸€é¡µé“¾æ¥ ğŸ› ï¼ˆGPTå¸®ä½ é˜…è¯»ï¼ï¼‰</p>
<div class="note note-green icon-padding"><i class="note-icon fa-solid fa-bolt"></i><p><strong>æ ¸å¿ƒæ–¹æ³•è®º</strong>ï¼šé—²æ¥æ— äº‹è¯»æ‰‹å†Œï¼ï¼ˆçœŸçš„å¾ˆéœ€è¦çƒ­æƒ…ã€‚ã€‚ã€‚ï¼‰<br>å‚è€ƒä¸€äº›æ‰‹å†Œå’Œæœ‰è¶£çš„å®ç°ï¼Œå¯ä»¥è·å¾—å¤§é‡çš„ç¼–ç¨‹ç»éªŒï¼Œç³»ç»ŸçŸ¥è¯†ï¼Œå’Œå¥‡æŠ€æ·«å·§ï¼<br>ä¸€ä¸ªå¸¸è§çš„practiceä¼šåœ¨å„ç§å„æ ·çš„å®ç°ä¸­è¢«åå¤ï¼Œä»ä¸­å­¦ä¹ ï¼<br>pptä¸Šç»™å‡ºäº†å¾ˆå¤šå¾ˆå¤šRTFM entries!ğŸ›</p>
</div>
<blockquote>
<p>offsetofå®ï¼šä¸€ä¸ªå¥‡æŠ€æ·«å·§ï¼</p>
</blockquote>
<p>printfå¸¦æ¥çš„å¯ç¤ºï¼šä¸€ä¸ªè½¯ä»¶å·¥ç¨‹ä¸Šçš„åŸåˆ™ï¼šé¿å…â€œcode cloneâ€<br>tls ğŸ›</p>
<div class="note note-green icon-padding"><i class="note-icon fa-solid fa-bolt"></i><p><strong>æ ¸å¿ƒæ–¹æ³•è®º</strong>ï¼šä»å„ç§å„æ ·çš„å¥‡æ€ªæœºåˆ¶çš„è°ƒè¯•ä¸­è·å¾—å’ŒåŠ æ·±å¯¹ç³»ç»Ÿçš„è®¤è¯†ï¼æ­¤æ—¶å†æ‰“å¼€æ‰‹å†Œï¼Œå°±ä¸æ˜¾å¾—å›°éš¾äº†ï¼ğŸ›</p>
</div>

<p>ğŸ”±è®¡ç®—æœºä¸–ç•Œä¸­æ²¡æœ‰ä»»ä½•çš„é­”æ³•ï¼ï¼ˆåªè¦ä½ ä¸å†™é”™ï¼‰</p>
<h2 id="L1"><a href="#L1" class="headerlink" title="L1"></a>L1</h2><p>æœ¬èº«æ˜¯Lect 17çš„å†…å®¹ï¼Œæ•´åˆè¿‡æ¥ã€‚<br>ä¼˜åŒ–å¿…é¡»è¦åŸºäºWorkloadï¼<br>ğŸ”±Knuth: Premature optimization is the root of all evil.</p>
<div class="note note-green icon-padding"><i class="note-icon fa-solid fa-bolt"></i><p><strong>æ ¸å¿ƒæ–¹æ³•è®º</strong>ï¼šWorkloadå“ªé‡Œæ¥ï¼Ÿè¯»è®ºæ–‡å»ï¼<br>å…¶å®è¿˜æœ‰profiler, tracerâ€¦</p>
</div>

<p>System äººçš„æ™ºæ…§ï¼šè¯¥çœçœè¯¥èŠ±èŠ±ï¼Œå…ˆæµªè´¹ï¼Œå†åœ¨ç°å®é—®é¢˜æƒ…æ™¯ä¸­æ‰¾è¡¥å›æ¥</p>
<h2 id="Lecture-18-V"><a href="#Lecture-18-V" class="headerlink" title="Lecture 18 (V)"></a>Lecture 18 (V)</h2><div class="note note-primary icon-padding"><i class="note-icon fa-solid fa-circle-arrow-right"></i><p><a class="link" target="_blank" rel="noopener" href="https://jyywiki.cn/OS/2024/lect18.md">åŠ¡å¿…æ­é…jyywikié£Ÿç”¨ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
</div>
<img lazyload="" src="/images/loading.svg" data-src="https://s2.loli.net/2024/04/30/O4HM3C5VZhPQ6kU.png" width="800">

<p>å°½åœ¨ä¸è¨€ä¸­ã€‚<br>Linuxå†å²ï¼šæˆ‘ä»¬æ“ä½œç³»ç»Ÿç•Œä¹Ÿæœ‰è‡ªå·±çš„<strong>åŸç¥</strong>ï¼</p>
<h2 id="Lecture-19-V-å¯æ‰§è¡Œæ–‡ä»¶ï¼Œé™æ€é“¾æ¥"><a href="#Lecture-19-V-å¯æ‰§è¡Œæ–‡ä»¶ï¼Œé™æ€é“¾æ¥" class="headerlink" title="Lecture 19 (V) å¯æ‰§è¡Œæ–‡ä»¶ï¼Œé™æ€é“¾æ¥"></a>Lecture 19 (V) å¯æ‰§è¡Œæ–‡ä»¶ï¼Œé™æ€é“¾æ¥</h2><p>ä»€ä¹ˆæ˜¯å¯æ‰§è¡Œæ–‡ä»¶ï¼Ÿ<br>æ“ä½œç³»ç»Ÿçš„å¯¹è±¡ï¼Œå­˜å‚¨çŠ¶æ€æœº(é™æ€çš„)åˆå§‹çŠ¶æ€çš„æ•°æ®ç»“æ„ã€‚<br>execve = åˆå§‹åŒ–Process(?) + åŠ è½½ELFï¼ˆè§„å®šäº†ç¨‹åºæ‰§è¡Œè¿›å…¥entryæ—¶åœ°å€ç©ºé—´é‡Œçš„ä¸œè¥¿ï¼‰</p>
<p><a class="link" target="_blank" rel="noopener" href="https://www.gnu.org/software/binutils/">Binutils <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>ğŸ›</p>
<p>ELFå¹¶ä¸äººç±»å‹å¥½ï¼Œå¹¶ä¸æ»¡è¶³â€ä¿¡æ¯å±€éƒ¨æ€§â€ã€‚(ABIæ‰‹å†Œè§„èŒƒçš„)<br>é‚£æˆ‘ä»¬é‡æ–°è®¾è®¡ä¸€ä¸ªå‹å¥½çš„ï¼<br><img lazyload="" src="/images/loading.svg" data-src="https://s2.loli.net/2024/05/14/JVvYfxjO7SLWnkM.png" width="600"></p>
<p>jammmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmjammmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmjammmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmjammmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmjammmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmjammmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmjammmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmjammmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmjammmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmjammmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmjammmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmjammmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmjammmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmjammmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmjammmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmjammmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmjammmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmjammmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmjammmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmjammmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmjammmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmm<br>ç°åœ¨çš„Core Dumpæ˜¯ELFæ–‡ä»¶â“<br>å¾ˆä¹…ä»¥å‰çš„â€œa.outâ€æ˜¯éå¸¸ç®€å•çš„ã€‚ï¼ˆä½†æ”¯æŒçš„éå¸¸å°‘ï¼Œæ¯”å¦‚è¯´ç”¨äºè°ƒè¯•çš„ç¬¦å·éƒ½å­˜åœ¨å“ªé‡Œï¼Ÿï¼‰</p>
<p>â€œFLEâ€ï¼šä»£ç ã€ç¬¦å·ã€é‡å®šä½ï¼<br>é™æ€é“¾æ¥æ˜¯ä»€ä¹ˆÂ·ï¼Ÿå°±æ˜¯åˆå¹¶åŒç±»é¡¹ï¼Œå†é‡å®šä½ï¼Œå°±æ˜¯è®¡ç®—å‡ºå¾…å®šçš„æŒ‡é’ˆå€¼ã€‚<br>ä¹¦ç­¾ä»¬ä¹Ÿè¦æ”¹å¥½ï¼ˆç¬¦å·ï¼‰<br>å¤ä¹ ICS: é«˜çº§è¯­è¨€ä»£ç (.c, text) â€“é¢„ç¼–è¯‘(å®å±•å¼€â€¦)â€“&gt; (.i, text) â€“ç¼–è¯‘â€“&gt; æ±‡ç¼–æŒ‡ä»¤åºåˆ—(.s, txt) â€“æ±‡ç¼–å™¨asâ€“&gt; ELF(.o, bin)<br>å¤ä¹ ä¸€ä¸‹ICSé“¾æ¥éƒ¨åˆ†ğŸ›</p>
<p>â€œFLEâ€çš„åŠ è½½ 56min<br>é˜…è¯»Funnyçš„ä»£ç </p>
<p>ELFæ˜¯é«˜æ•ˆçš„ï¼Œå†…å­˜èŠ‚çœçš„ï¼Œindustrial çš„é€‰æ‹©<br>threadlocal</p>
<p>é™æ€ELFåŠ è½½å™¨é‚£é‡Œ</p>
<p>execveä¸­çš„è¡Œä¸ºï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå·±å®ç°ï¼</p>
<h2 id="Lecture-20-V"><a href="#Lecture-20-V" class="headerlink" title="Lecture 20 (V)"></a>Lecture 20 (V)</h2><p>A software engineering view<br>å®ç°è¿è¡Œåº“å’Œåº”ç”¨ä»£ç åˆ†ç¦»</p>
<ul>
<li>åº”ç”¨ä¹‹é—´çš„åº“å…±äº«(å ç”¨å­˜å‚¨å¤ªå¤§äº†)</li>
<li>å¤§å‹é¡¹ç›®çš„åˆ†è§£</li>
<li>ä¾èµ–ä¹Ÿæ˜¯å…‹éš†ï¼Œå¯ä»¥åŒæ—¶æ›´æ–°æ— æ•°çš„ç¨‹åºï¼ˆå¦åˆ™éœ€è¦é‡æ–°é“¾æ¥æ— æ•°çš„ç¨‹åºï¼‰</li>
</ul>
<p>å‰é¢é‚£ä¸ªæ›´æ–°ç½‘é¡µä¾èµ–å‰é¢ä¸€ç‚¹ï¼ˆå†å¬ä¸€ä¸‹ï¼‰<br>Semantic Version</p>
<p>Dependency Hell</p>
<p>libc.oï¼ˆé™æ€é“¾æ¥ï¼‰<br>æ²¡èŠ‚çœå†…å­˜ï¼ˆè¿˜æ˜¯è¦åœ¨å†…å­˜é‡Œæœ‰å¾ˆå¤šä»½ï¼‰ï¼Œè€Œä¸”è¿˜è§£æäº†ä¸€å¤§å †ç”¨ä¸åˆ°çš„ç¬¦å·</p>
<p>libc.so(åŠ¨æ€é“¾æ¥)<br><strong>å¬ä¸€ä¸‹</strong></p>
<p>ldd<br>ld.so ğŸ›</p>
<div class="note note-green icon-padding"><i class="note-icon fa-solid fa-bolt"></i><p>æ ¸å¿ƒæ–¹æ³•è®º SEE ALSO in Manual</p>
</div>

<p>LD_PRELOAD</p>
<h2 id="Lecture-21-K-Syscall-intr"><a href="#Lecture-21-K-Syscall-intr" class="headerlink" title="Lecture 21 (K) Syscall, intr"></a>Lecture 21 (K) Syscall, intr</h2><p>ç³»ç»Ÿè°ƒç”¨ï¼šå‘æ“ä½œç³»ç»Ÿçš„ â€œå‡½æ•°è°ƒç”¨â€</p>
<p><code>syscall</code>æŒ‡ä»¤ = è·³è½¬å¹¶ææƒ<br>in RISC-V </p>
<h2 id="Lecture-22-K-from-Thread-to-Process"><a href="#Lecture-22-K-from-Thread-to-Process" class="headerlink" title="Lecture 22 (K) from Thread to Process"></a>Lecture 22 (K) from Thread to Process</h2><div class="note note-primary icon-padding"><i class="note-icon fa-solid fa-circle-arrow-right"></i><p><a class="link" target="_blank" rel="noopener" href="https://jyywiki.cn/OS/2024/lect22.md">åŠ¡å¿…æ­é…jyywikié£Ÿç”¨ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
</div>
<p>Process = Thread + VR glasses(addr translation)<br>ç”¨ä¸€ä¸ªæ•°æ®ç»“æ„æ¥ç»´æŠ¤åœ°å€çš„Mapï¼ˆä¸€ä¸ªæ˜ å°„å‡½æ•°<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.464ex;" xmlns="http://www.w3.org/2000/svg" width="1.244ex" height="2.059ex" role="img" focusable="false" viewBox="0 -705 550 910"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D453" d="M118 -162Q120 -162 124 -164T135 -167T147 -168Q160 -168 171 -155T187 -126Q197 -99 221 27T267 267T289 382V385H242Q195 385 192 387Q188 390 188 397L195 425Q197 430 203 430T250 431Q298 431 298 432Q298 434 307 482T319 540Q356 705 465 705Q502 703 526 683T550 630Q550 594 529 578T487 561Q443 561 443 603Q443 622 454 636T478 657L487 662Q471 668 457 668Q445 668 434 658T419 630Q412 601 403 552T387 469T380 433Q380 431 435 431Q480 431 487 430T498 424Q499 420 496 407T491 391Q489 386 482 386T428 385H372L349 263Q301 15 282 -47Q255 -132 212 -173Q175 -205 139 -205Q107 -205 81 -186T55 -132Q55 -95 76 -78T118 -61Q162 -61 162 -103Q162 -122 151 -136T127 -157L118 -162Z"></path></g></g></g></svg></mjx-container>ï¼‰<br>RBTï¼Ÿä¸å¤Ÿå¿«ï¼</p>
<ul>
<li><strong>ç”¨Radix Treeæ¥å®ç°</strong> riscv, x86, arm<ul>
<li><a class="link" target="_blank" rel="noopener" href="https://www.cnblogs.com/wgwyanfs/p/6887889.html">A blog <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li>
<li>(1024å‰æ ‘ for 32-bit machine)<ul>
<li>i386çš„äºŒçº§é¡µè¡¨</li>
</ul>
</li>
<li>64-bitä¸é‚£ä¹ˆå¥½ç©äº†ï¼Œ4KBé¡µé¢ä¸­åªæœ‰512ä¸ªæŒ‡é’ˆäº†ï¼Œä¸æ•´ã€‚<ul>
<li>x86_64: PML4, PML5</li>
<li>riscv: åªè¦ä¸‰çº§ï¼Œåªèƒ½ç´¢å¼•åˆ°512GBçš„å†…å­˜</li>
</ul>
</li>
<li>å› ä¸ºé¡µè¡¨åœ¨å†…å­˜é‡Œï¼Œä¸å¤Ÿå¿«ï¼Œæ‰€ä»¥è¿˜æ˜¯è¦ç”¨TLB</li>
<li>CR3æŒ‡å‘ä¸€çº§é¡µè¡¨çš„åŸºå€</li>
</ul>
</li>
<li><strong>ä¸å®ç°</strong> MIPS ï¼ˆâ€œæ–‡è‰ºå®ç°â€ï¼‰<br>ç¡¬ä»¶åªç®¡TLBç¼“å­˜å’Œç‰©ç†å†…å­˜ï¼Œé¡µè¡¨ä»€ä¹ˆï¼Œéšä½ å–œæ¬¢ï¼<br>ç¼ºé¡µå‘ç”Ÿæ—¶ï¼Œäº§ç”Ÿä¸€ä¸ªå¼‚å¸¸ï¼Œäº¤ç”±æ“ä½œç³»ç»Ÿå¤„ç†ã€‚<br>æä¾›æŒ‡ä»¤ <code>tlbwi</code> <code>tlbwr</code> ç»™æ“ä½œç³»ç»Ÿå†™å…¥TLB<blockquote>
<p>ç¡¬ä»¶åœ¨å˜å¾—è¶Šæ¥è¶Šå¯ç¼–ç¨‹ï¼Œä¸€ç§æ˜¯æœ¬èº«å°±å¯ç¼–ç¨‹(FPGAâ€¦)ï¼Œä¸€ç§æ˜¯æä¾›è½¯ä»¶çš„æ¥å£è‡ªç”±å®ç°ï¼ˆå°±åƒè¿™ä¸ªï¼‰</p>
</blockquote>
</li>
<li><strong>Hash tableå®ç°</strong> invert page table(â€œç–¯ç‹‚å®ç°â€)<br>æŠŠè¿›ç¨‹å·ä¹Ÿä½œä¸ºè™šæ‹Ÿåœ°å€çš„ä¸€éƒ¨åˆ†ï¼Œç›´æ¥è¿›è¡ŒHash<br>ä¼šæœ‰å®‰å…¨é—®é¢˜</li>
</ul>
<p>ç–¯ç‹‚å¡«å†™ï¼ˆæ— èƒ½ç‹‚æ€’ï¼‰<code>nop</code> çš„libbloat.soï¼š</p>
<ul>
<li>ä¸ä¼šæ¦¨å¹²å†…å­˜ï¼å› ä¸ºOSä¼šæŠŠå®ƒä»¬æŒ‡å‘åŒä¸€ä»½ä»£ç (æ˜ å°„å‡½æ•°<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.464ex;" xmlns="http://www.w3.org/2000/svg" width="1.244ex" height="2.059ex" role="img" focusable="false" viewBox="0 -705 550 910"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D453" d="M118 -162Q120 -162 124 -164T135 -167T147 -168Q160 -168 171 -155T187 -126Q197 -99 221 27T267 267T289 382V385H242Q195 385 192 387Q188 390 188 397L195 425Q197 430 203 430T250 431Q298 431 298 432Q298 434 307 482T319 540Q356 705 465 705Q502 703 526 683T550 630Q550 594 529 578T487 561Q443 561 443 603Q443 622 454 636T478 657L487 662Q471 668 457 668Q445 668 434 658T419 630Q412 601 403 552T387 469T380 433Q380 431 435 431Q480 431 487 430T498 424Q499 420 496 407T491 391Q489 386 482 386T428 385H372L349 263Q301 15 282 -47Q255 -132 212 -173Q175 -205 139 -205Q107 -205 81 -186T55 -132Q55 -95 76 -78T118 -61Q162 -61 162 -103Q162 -122 151 -136T127 -157L118 -162Z"></path></g></g></g></svg></mjx-container>ä¸ä¸€å®šæ˜¯å•å°„)</li>
<li>å³ä½¿æ˜¯100Gï¼Œä¹Ÿä¸ä¼šè¢«åªè¯»å†…å­˜æ¦¨å¹²ï¼<br>Kernel Samepage Merging, ä¸åªä¸¤ä¸ªè¿›ç¨‹æŒ‡å‘çš„â€œé€»è¾‘ä½ç½®ç›¸åŒâ€çš„ä»£ç ä¼šè¢«åˆå¹¶ï¼Œâ€œå†…å®¹ç›¸åŒâ€çš„é¡µä¹Ÿä¼šè¢«åˆå¹¶ï¼<br>ï¼ˆå³ä½¿æ˜¯Mallocçš„ï¼Œä¹Ÿä¸ä¼šï¼ï¼‰</li>
<li>å³ä½¿æ˜¯éšæœºä»£ç ï¼Œä¹Ÿä¸ä¼šè¢«æ¦¨å¹²ï¼Demand paging<br>ç£ç›˜å¯ä»¥è¢«æ˜ å°„åˆ°åœ°å€ç©ºé—´ï¼Œæ­¤æ—¶ä½¿ç”¨æŒ‡é’ˆè®¿é—®å®ƒ<br>ç¼ºé¡µï¼Œæ“ä½œç³»ç»Ÿé€šè¿‡æ•°æ®ç»“æ„å‘ç°å®ƒè¢«æ˜ å°„åˆ°è®¾å¤‡ï¼ŒæŠŠè¯¥é¡µè¯»å…¥å†…å­˜å†åŠ å…¥æ˜ å°„<br>åœ°å€ç©ºé—´è£…ä¸ä¸‹è¿™ä¹ˆå¤§ï¼Œè¯¥æ€ä¹ˆç´¢å¼•ï¼Ÿä¸æ˜¯æ­£å¸¸æŒ‡é’ˆï¼Œç”¨æ–‡ä»¶æè¿°ç¬¦è¿™ç§ç‹¬ç«‹çš„æŒ‡é’ˆğŸ’å°šéœ€ç¡®è®¤</li>
</ul>
<p>è¿›è€Œæ¶‰åŠ Swap pageæœºåˆ¶ï¼ˆé¡µé¢äº¤æ¢/è™šæ‹Ÿå†…å­˜ï¼‰<br>æ“ä½œç³»ç»Ÿä¼šæŠŠé—²ç½®çš„é¡µå¡å›ç£ç›˜é‡Œå»ã€‚</p>
<p>é«˜æ€§èƒ½çš„å®ç°forkï¼šCopy-on-write fork()</p>
<ul>
<li>å²æœˆå²ä¹¦ï¼švfork()</li>
<li>åªè¯»æ—¶æµ…æ‹·è´ï¼Œä¸å¾—ä¸copyï¼ˆå‘ç”Ÿå†™äº‹ä»¶åœ¨å…±äº«è¯»çš„é¡µä¸Šï¼Œå‘ç”Ÿä¸€ä¸ªExceptionï¼‰å†deepcopy</li>
<li>å¯ä»¥ä¸ºæœåŠ¡å™¨ä½œè¿›ç¨‹å¿«ç…§ï¼šå¯ä»¥å½“çˆ¶è¿›ç¨‹æŒ‚äº†çš„æ—¶å€™ï¼Œç”¨å¿«ç…§é¡¶ä¸Šã€‚</li>
</ul>
<p>æ‰€è°“å±€éƒ¨æ€§å°±æ˜¯ï¼Œä½ æ‰‹å’Œçœ¼ç›çš„æ¥è§¦çš„èŒƒå›´æœ‰é™ï¼Œä½ ç”¨VRçœ¼é•œçš„è§†çº¿ä¹‹å¤–çš„éƒ¨åˆ†ï¼Œæ“ä½œç³»ç»Ÿå¯ä»¥éšæ„ä¹±æã€‚ï¼ˆç‰ºç‰²ä¸€äº›æ€§èƒ½ï¼Œä½†ä¿è¯ä¸ä¼šè¢«æ¦¨å¹²crashæ‰ï¼‰</p>
<p>ä¸€äº›åœºæ™¯ä¸‹ä½¿ç”¨2Mçš„å¤§é¡µ</p>
<p>ğŸ”±The most important characteristics of the system are its simplicity, elegance, and ease of use. </p>
<p>ğŸªUNIXçš„å²æœˆå²ä¹¦ï¼ˆpptï¼‰<br>gets(buf)</p>
<p>â€œåœ¨äººå·¥æ™ºèƒ½çš„è¾…åŠ©ä¸‹ä»€ä¹ˆâ€34minå·¦å³â€¦å¥½åƒè¢«å‰ªæ‰äº†ã€‚ã€‚ã€‚</p>
<div class="note-large notel-orange"><div class="notel-title"><p>Extention:XV6ğŸ›</p>
</div><div class="notel-content"><p><a class="link" target="_blank" rel="noopener" href="https://pdos.csail.mit.edu/6.828/2023/xv6.html">https://pdos.csail.mit.edu/6.828/2023/xv6.html <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a><br><a class="link" target="_blank" rel="noopener" href="https://jyywiki.cn/OS/manuals/book-riscv-rev3.pdf">https://jyywiki.cn/OS/manuals/book-riscv-rev3.pdf <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
 </div></div>

<h2 id="Lecture-23-K-Schedule"><a href="#Lecture-23-K-Schedule" class="headerlink" title="Lecture 23 (K) Schedule"></a>Lecture 23 (K) Schedule</h2><div class="note note-primary icon-padding"><i class="note-icon fa-solid fa-circle-arrow-right"></i><p><a class="link" target="_blank" rel="noopener" href="https://jyywiki.cn/OS/2024/lect23.md">åŠ¡å¿…æ­é…jyywikié£Ÿç”¨ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
</div>
<p>å‰é¢Meltdowné‚£é‡ŒğŸ’<br>è¿›ç¨‹æ— æ³•ç›´æ¥çœ‹åˆ°å†…æ ¸ä»£ç ï¼Œæ€ä¹ˆè·³è¿‡å»ï¼Ÿ<br>Tramploine: ä¸€ä¸ªå°çš„ä»£ç ç‰‡æ®µï¼Œç”¨æ¥è·³è½¬åˆ°å†…æ ¸ä»£ç </p>
<p>gdb-multiarch</p>
<p>é˜…è¯»XV6çš„initä»£ç ğŸ’ç¬¬ä¸€ä¸ªè¿›ç¨‹</p>
<p>è°ƒåº¦ï¼š<br>å»ºæ¨¡â†’é¢„æµ‹â†’å†³ç­–</p>
<p>UNIX Niceness<br>[-20, 20) è¶Šå°çš„è¶Šåï¼Œâ€œåâ€å°±æ˜¯ä¸æ„¿æ„è®©ç»™åˆ«äºº<br>Niceç›¸å·®10å¤§æ¦‚æ˜¯èµ„æºå·®åå€<br>When Nices equals<br>ä¸èƒ½Round-and-Robinï¼Œä½å ç”¨çš„å³æ—¶å‰å°ç¨‹åºä¸èƒ½å’Œé«˜å ç”¨çš„åå°R&amp;Rã€‚</p>
<p>å†å¬ä¸€ä¸‹MLFQğŸ’<br>CFS<br>çº¢é»‘æ ‘</p>
<div class="note-large notel-red"><div class="notel-title"><p>ğŸŒ¶ï¸Spicy:</p>
</div><div class="notel-content"><p>ä¼˜å…ˆçº§åè½¬ğŸ’<br>Linuxï¼šè§£å†³ä¸äº†ï¼Œæ‹œæ‹œ<br>å®‰å“æ‰‹æœºè¶Šç”¨è¶Šå¡ï¼Œä¸€äº›åƒåœ¾åº”ç”¨è·å¾—é«˜ä¼˜å…ˆçº§çš„ğŸ”’ï¼Œå¯¼è‡´äº†ç³»ç»Ÿçš„å¡é¡¿</p>
<p>å¯¹ç§°å¤šå¤„ç†å™¨ SMP<br>ä¸èƒ½éšæœºåˆ†é…ï¼Œçº¿ç¨‹é€€å‡ºä¹‹åå¤„ç†å™¨ä¼šâ€å›´è§‚åˆ«äººå¹²æ´»â€<br>ä¹Ÿä¸èƒ½è°ç©ºåˆ†ç»™è°ï¼Œä¼šæŸå¤±ç¼“å­˜çš„ä¿¡æ¯ï¼šåŒå¤„ç†å™¨è·¨æ ¸L1å°±æ²¡äº†ï¼Œè·¨å¤„ç†å™¨L2/L3ä¹Ÿæ²¡äº†ï¼ˆå…·ä½“æ¶æ„ç›¸å…³ï¼‰</p>
<p>äº‹å®ä¸ŠSMPè¿˜æ˜¯ä¸ç†æƒ³çš„å»ºæ¨¡ï¼šç°åœ¨çš„å¤„ç†å™¨ä¸å¯¹ç§°äº†</p>
<p>å¤šç”¨æˆ·</p>
<p>ç¨‹åºæ‰§è¡Œä¹Ÿæ²¡æœ‰é‚£ä¹ˆç®€å•ï¼š<br>æœ‰æ—¶æ›´å¤šçš„èµ„æºåè€Œä¼šå˜æ…¢ã€‚<br>å…±äº«å†…å­˜çš„Cache slotåœ¨ä¸åŒå¤„ç†å™¨ä¹‹é—´ç–¯ç‹‚æ¨ªè·³ã€‚</p>
 </div></div>



            </div>

            
                <div class="post-copyright-info">
                    <div class="article-copyright-info-container">
    <ul>
        <li>Post titleï¼šTalk to the Godâ€”â€”Notes for jyy OS</li>
        <li>Post authorï¼šJackcui</li>
        <li>Create timeï¼š2024-02-28 09:02:59</li>
        <li>
            Post linkï¼šhttps://jackcuii.github.io/2024/02/28/OS/
        </li>
        <li>
            Copyright Noticeï¼šAll articles in this blog are licensed under <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">BY-NC-SA</a> unless stating additionally.
        </li>
    </ul>
</div>

                </div>
            

            
                <ul class="post-tags-box">
                    
                        <li class="tag-item">
                            <a href="/tags/CS/">#CS</a>&nbsp;
                        </li>
                    
                        <li class="tag-item">
                            <a href="/tags/Notes/">#Notes</a>&nbsp;
                        </li>
                    
                </ul>
            

            

            
                <div class="article-nav">
                    
                        <div class="article-prev">
                            <a class="prev"
                            rel="prev"
                            href="/2024/03/01/HPP/"
                            >
                                <span class="left arrow-icon flex-center">
                                    <i class="fa-solid fa-chevron-left"></i>
                                </span>
                                <span class="title flex-center">
                                    <span class="post-nav-title-item">Notes for Heterogeneous Parallel Programming By W. Hwu</span>
                                    <span class="post-nav-item">Prev posts</span>
                                </span>
                            </a>
                        </div>
                    
                    
                        <div class="article-next">
                            <a class="next"
                            rel="next"
                            href="/2024/02/26/ComputerNetwork/"
                            >
                                <span class="title flex-center">
                                    <span class="post-nav-title-item">Notes for Computer Network</span>
                                    <span class="post-nav-item">Next posts</span>
                                </span>
                                <span class="right arrow-icon flex-center">
                                    <i class="fa-solid fa-chevron-right"></i>
                                </span>
                            </a>
                        </div>
                    
                </div>
            


            
                <div class="comment-container">
                    <div class="comments-container">
    <div id="comment-anchor"></div>
    <div class="comment-area-title">
        <i class="fa-solid fa-comments"></i>&nbsp;Comments
    </div>
    

        
            
 
    <div id="waline"></div>
    <script type="module"  data-pjax>
        import { init } from 'https://evan.beee.top/js/waline.mjs';

        function loadWaline() {
            init({
                el: '#waline',
                serverURL: 'https://comment.jackcuii.cn/',
                lang: 'zh-CN',
                dark: 'body[class~="dark-mode"]',
                requiredMeta: ['nick','mail'], // cannot customize by theme config, change it yourself
            });
        }

        if ('true') {
            const loadWalineTimeout = setTimeout(() => {
                loadWaline();
                clearTimeout(loadWalineTimeout);
            }, 1000);
        } else {
            window.addEventListener('DOMContentLoaded', loadWaline);
        }
        
    </script>



        
    
</div>

                </div>
            
        </div>

        
            <div class="toc-content-container">
                <div class="post-toc-wrap">
    <div class="post-toc">
        <div class="toc-title">On this page</div>
        <div class="page-title">Talk to the Godâ€”â€”Notes for jyy OS</div>
        <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#References"><span class="nav-text">References</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Waiting-List"><span class="nav-text">Waiting List</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%AA%E8%AE%BA"><span class="nav-text">ç»ªè®º</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%89%B9%E5%88%AB%E8%AF%B4%E6%98%8E"><span class="nav-text">ç‰¹åˆ«è¯´æ˜</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Lecture-1"><span class="nav-text">Lecture 1</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Lecture-2"><span class="nav-text">Lecture 2</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#M1-pstree"><span class="nav-text">M1:pstree</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Lecture-3"><span class="nav-text">Lecture 3</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Lecture-4"><span class="nav-text">Lecture 4</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Lecture-5-C"><span class="nav-text">Lecture 5 (C)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Lecture-6-C"><span class="nav-text">Lecture 6 (C)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Lecture-7-C"><span class="nav-text">Lecture 7 (C)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Lecture-8-Snack"><span class="nav-text">Lecture 8 (Snack)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Lecture-9-C"><span class="nav-text">Lecture 9 (C)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Lecture-10-C"><span class="nav-text">Lecture 10 (C)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Lecture-11-Snack"><span class="nav-text">Lecture 11 (Snack)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Lecture-12-C"><span class="nav-text">Lecture 12 (C)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Lecture-13-C"><span class="nav-text">Lecture 13 (C)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Lecture-14-V"><span class="nav-text">Lecture 14 (V)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Lecture-15-V"><span class="nav-text">Lecture 15 (V)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Lecture-16-V"><span class="nav-text">Lecture 16 (V)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Lecture-17-V"><span class="nav-text">Lecture 17 (V)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#L1"><span class="nav-text">L1</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Lecture-18-V"><span class="nav-text">Lecture 18 (V)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Lecture-19-V-%E5%8F%AF%E6%89%A7%E8%A1%8C%E6%96%87%E4%BB%B6%EF%BC%8C%E9%9D%99%E6%80%81%E9%93%BE%E6%8E%A5"><span class="nav-text">Lecture 19 (V) å¯æ‰§è¡Œæ–‡ä»¶ï¼Œé™æ€é“¾æ¥</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Lecture-20-V"><span class="nav-text">Lecture 20 (V)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Lecture-21-K-Syscall-intr"><span class="nav-text">Lecture 21 (K) Syscall, intr</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Lecture-22-K-from-Thread-to-Process"><span class="nav-text">Lecture 22 (K) from Thread to Process</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Lecture-23-K-Schedule"><span class="nav-text">Lecture 23 (K) Schedule</span></a></li></ol>

    </div>
</div>
            </div>
        
    </div>
</div>


                

            </div>



        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info">
            &copy;
            
              <span>2022</span>
              -
            
            2024&nbsp;&nbsp;<i class="fa-solid fa-heart fa-beat" style="--fa-animation-duration: 0.5s; color: #f54545"></i>&nbsp;&nbsp;<a href="/">Jackcui</a>
        </div>
        
            <script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                    <span id="busuanzi_container_site_uv" class="busuanzi_container_site_uv">
                        VISITOR COUNT&nbsp;<span id="busuanzi_value_site_uv" class="busuanzi_value_site_uv"></span>
                    </span>
                
                
                    <span id="busuanzi_container_site_pv" class="busuanzi_container_site_pv">
                        TOTAL PAGE VIEWS&nbsp;<span id="busuanzi_value_site_pv" class="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="theme-info info-item">
            <span class="powered-by-container">POWERED BY <?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg version="1.1" id="åœ–å±¤_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1rem" height="1rem" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path fill="#0E83CD" d="M256.4,25.8l-200,115.5L56,371.5l199.6,114.7l200-115.5l0.4-230.2L256.4,25.8z M349,354.6l-18.4,10.7l-18.6-11V275H200v79.6l-18.4,10.7l-18.6-11v-197l18.5-10.6l18.5,10.8V237h112v-79.6l18.5-10.6l18.5,10.8V354.6z"/></svg><a target="_blank" href="https://hexo.io">Hexo</a></span>
                <br> 
            <span class="theme-version-container">THEME&nbsp;<a class="theme-version" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v1.2.3</a>
        </div>
        
        
        
            <div id="start_time_div" style="display:none">
                2022/8/17 11:45:14
            </div>
            <div>
                Blog up for <span class="odometer" id="runtime_days" ></span> days <span class="odometer" id="runtime_hours"></span> hrs <span class="odometer" id="runtime_minutes"></span> Min <span class="odometer" id="runtime_seconds"></span> Sec
            </div>
        
        
        
            <script async data-pjax>
                try {
                    function odometer_init() {
                    const elements = document.querySelectorAll('.odometer');
                    elements.forEach(el => {
                        new Odometer({
                            el,
                            format: '( ddd).dd',
                            duration: 200
                        });
                    });
                    }
                    odometer_init();
                } catch (error) {}
            </script>
        
        
        
    </div>  
</footer>
        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="right-bottom-tools page-aside-toggle">
                <i class="fa-regular fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
            <li class="go-comment">
                <i class="fa-regular fa-comments"></i>
            </li>
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="unfolded-tools-list">
        <li class="right-bottom-tools tool-font-adjust-plus flex-center">
            <i class="fa-regular fa-magnifying-glass-plus"></i>
        </li>

        <li class="right-bottom-tools tool-font-adjust-minus flex-center">
            <i class="fa-regular fa-magnifying-glass-minus"></i>
        </li>

        <li class="right-bottom-tools tool-expand-width flex-center">
            <i class="fa-regular fa-expand"></i>
        </li>

        <li class="right-bottom-tools tool-dark-light-toggle flex-center">
            <i class="fa-regular fa-moon"></i>
        </li>

        <!-- rss -->
        

        
            <li class="right-bottom-tools tool-scroll-to-top flex-center">
                <i class="fa-regular fa-arrow-up"></i>
            </li>
        

        <li class="right-bottom-tools tool-scroll-to-bottom flex-center">
            <i class="fa-regular fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="folded-tools-list">
        <li class="right-bottom-tools tool-toggle-show flex-center">
            <i class="fa-regular fa-cog fa-spin"></i>
        </li>
        
    </ul>
</div>

    </div>

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fa-solid fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="Search..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fa-solid fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fa-solid fa-spinner fa-spin-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    


</main>




<script src="/js/utils.js"></script>

<script src="/js/main.js"></script>

<script src="/js/layouts/menu-shrink.js"></script>

<script src="/js/tools/go-top-bottom.js"></script>

<script src="/js/tools/dark-light-toggle.js"></script>



    
<script src="/js/tools/local-search.js"></script>




    
<script src="/js/tools/code-block.js"></script>




    
<script src="/js/layouts/lazyload.js"></script>




    
<script src="/js/tools/runtime.js"></script>

    
<script src="/js/layouts/odometer.min.js"></script>

    
<link rel="stylesheet" href="/assets/odometer-theme-minimal.css">




  
<script src="/js/libs/Typed.min.js"></script>

  
<script src="/js/plugins/typed.js"></script>







<div class="post-scripts pjax">
    
        
<script src="/js/tools/toc-toggle.js"></script>

<script src="/js/libs/anime.min.js"></script>

<script src="/js/layouts/toc.js"></script>

<script src="/js/plugins/tabs.js"></script>

    
</div>


    
<script src="/js/libs/pjax.min.js"></script>

<script>
    window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax'
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
            // scrollTo: true,
        });

        document.addEventListener('pjax:send', () => {
            REDEFINE.utils.pjaxProgressBarStart();
        });

        document.addEventListener('pjax:complete', () => {
            REDEFINE.utils.pjaxProgressBarEnd();
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
            REDEFINE.refresh();
        });
    });
</script>




    <div id="aplayer"></div>

<script src="/js/libs/APlayer.min.js"></script>


<script src="/js/plugins/aplayer.js"></script>


</body>
</html>
